jetstarActivities=(function(){return{init:function(){if(window.console==undefined){window.console={log:function(){}}}this.toggles()},toggles:function(){$(".passenger-section #Activities select").each(function(){var input=$(this);var inputVal=input.val();input.bind("focusin",function(){input.removeClass("default");if(input.val()!=inputVal){return false}input.val("0")});input.blur(function(){if(input.val()==""){input.addClass("default");input.val(inputVal)}else{if(input.val()=="0"){input.addClass("default")}else{input.removeClass("default")}}$(".select-areacode").removeClass("default")})})}}})();jetstarTransfers=(function(){var isIE6=false;var isIE7=false;var timeoutInterval;var timeoutExpired;return{init:function(){if(window.console==undefined){window.console={log:function(){}}}isIE6=($("html").hasClass("ie6")?true:false);isIE7=($("html").hasClass("ie7")?true:false);this.toggles();this.enableDropOffAddressFieldValidation()},toggles:function(){$(".passenger-section #Transfers select").each(function(){var input=$(this);var inputVal=input.val();input.blur(function(){if(input.val()==""){input.addClass("default");input.val(inputVal)}else{input.removeClass("default")}$(".select-areacode").removeClass("default")})})},enableDropOffAddressFieldValidation:function(){function removeText(targetText,textToRemove){if(textToRemove.length<1){return targetText}var startIndex=targetText.indexOf(textToRemove);if(startIndex<0){return targetText}var result=targetText.substring(startIndex,textToRemove.length);return result}function enableValueMatchValidation(fieldReference,errorMessageReference){$(fieldReference).blur(function(){jetstarTransfers.doRequiredFieldValidation(this,$(this).attr("defaultValue"));if((typeof destinationName)!="undefined"&&destinationName.length>0){var dropOffCityName=destinationName.toLowerCase();dropOffCityName=removeText(dropOffCityName," city");jetstarTransfers.doFieldContainsValueValidation(this,dropOffCityName,errorMessageReference)}})}$(".dropOffLocationName, .pickUpLocationName").blur(function(){jetstarTransfers.doRequiredFieldValidation(this,$(this).attr("defaultValue"))});enableValueMatchValidation(".dropOffLocationAddress",".dropOffInputErrorMessage");enableValueMatchValidation(".pickUpLocationAddress",".pickUpInputErrorMessage")},doRequiredFieldValidation:function(field,defaultValue){if(field.value.length<1){$(field).val(defaultValue)}},doFieldContainsValueValidation:function(field,mustHaveValue,errorFieldReference){$(field).removeClass("error");$(errorFieldReference).css("display","none");if(field.value.toLowerCase().indexOf(mustHaveValue.toLowerCase())===-1){$(field).addClass("error");if((typeof dropOffAddressInvalidCityErrorMessage)!="undefined"&&dropOffAddressInvalidCityErrorMessage.length>0){jetstarTransfers.displayDropOffFieldErrorMessage(errorFieldReference,dropOffAddressInvalidCityErrorMessage)}else{jetstarTransfers.displayDropOffFieldErrorMessage(errorFieldReference,"Please ensure drop off location is same as transfer location.")}}},displayDropOffFieldErrorMessage:function(errorFieldReference,message){$(errorFieldReference).text(message);$(errorFieldReference).css("display","block")}}})();function SearchCars(pagePrefix,pickupDate,dropoffDate,carTypePreferred,isManualTriggered){var Url=pagePrefix+"Car.aspx";var isMmbw=$("#main").hasClass("mmbw-cars");if(pickupDate!=undefined&&dropoffDate!=undefined&&carTypePreferred!=undefined){jetstarAncillary.disableContinue();fields={pickupDate:pickupDate,dropoffDate:dropoffDate,carTypePreferred:carTypePreferred};DoAjaxCall("GET",Url,fields,"html","Cars",CarsLoading,isMmbw?function(){SearchCarsSuccess(isManualTriggered)}:CarsDisplayedSuccess,undefined,tcAjaxCallError)}else{DoAjaxCall("GET",Url,location.search.substring(1),"html","Cars",CarsLoading,isMmbw?function(){SearchCarsSuccess(isManualTriggered)}:CarsDisplayedSuccess,undefined,tcAjaxCallError)}}function SearchCarsSuccess(isManualTriggered){CarsDisplayedSuccess();if(isManualTriggered&&!$("#Cars").is(":visible")){$("#Cars").removeClass("hidden")}}function CarsDisplayedSuccess(){jetstarAncillary.carsLoaded();jetstarAncillary.enableContinue();var isMmbw=$("#main").hasClass("mmbw-cars");$(".cars-summary").removeClass("hidden");if(isMmbw){var bookedCars=$("#Cars .car-booking").html(),addedToCart=$("#Cars div.car-booking div.booked-item.added-to-cart"),carAvailability=$("#carAvailabilityContainer");$("#mmbw-booked-cars .booked-items div.booked-item.added-to-cart").replaceWith("");if($(addedToCart).length>0){$("#mmbw-booked-cars").fadeIn("slow");$("#mmbw-booked-cars .booked-items").removeClass("hidden");$("#mmbw-booked-cars .booked-items").prepend(addedToCart);$("#Cars").addClass("hidden");$("#mmbw-booked-cars").removeClass("loading")}else{$("#mmbw-booked-cars").fadeOut("slow");$("#Cars").removeClass("hidden")}if(carAvailability===undefined||carAvailability===null||(carAvailability&&carAvailability.length===0)){$("#Cars").removeClass("cars");$("#Cars").addClass("no-results")}$("#Cars .car-booking").replaceWith("");$("#mmbw-booked-cars").removeClass("loading");$("#mmbw-booked-cars .wait-image").fadeOut("slow")}else{if(carBooked=="True"){if(!isMmbw){$("#Cars").addClass("extras-confirmation");$("#Cars").removeClass("cars");$("#CarSearch").addClass("hidden");rhs.updateSummary($(".add-car"));$("#Cars .cars-container").removeClass("hidden")}}else{if((typeof carResultsFound)=="undefined"||carResultsFound=="False"){$("#Cars").addClass("no-results");$("#Cars").removeClass("cars");$("#Cars").html($("#car-no-result-returned").html());$(".cars-summary").addClass("hidden")}}}ReinitiateValidation("div#Cars form")}function CarSelectedSuccess(){jetstarAncillary.carsLoaded();jetstarAncillary.enableContinue();if(!$("#Cars").hasClass("cars")){$("#Cars").addClass("cars")}$("#Cars").addClass("extras-confirmation");$("#Cars").removeClass("cars");$("#CarSearch").addClass("hidden");rhs.updateSummary($(".add-car"))}function SellCar(UrlPrefix,carsControlId){var Url=UrlPrefix+"Car.aspx";jetstarAncillary.disableContinue();var fields=CreatedParams("Cars",carsControlId+"$BookLink");DoAjaxCall("POST",Url,fields,"html","Cars",CarsLoading,CarSelectedSuccess)}function CarCancelledSuccess(){var isMmbw=$("#main").hasClass("mmbw-cars");if(isMmbw){var bookedCarsHtml=$("#Cars .car-booking").html(),addedToCart=$("#Cars div.car-booking div.booked-item.added-to-cart");$("#added-mmbw-cars-summary").html("");if($(addedToCart).length>0){$("#mmbw-booked-cars .booked-items").html(bookedCarsHtml);$("#mmbw-booked-cars").fadeIn("slow");$("#added-car-mesage").fadeOut("slow",function(){$("#added-mmbw-cars-summary").fadeIn("slow")});$("#mmbw-booked-cars").removeClass("loading");var cart=jetstarBook.manageBooking.cart;$(addedToCart).each(function(i,car){var desc=$(car).find(".col-right h3").html();$("#added-mmbw-cars-summary").append($("<li>").addClass("added-car-item").append(desc))});if(cart&&cart!==undefined){cart.UpdateCarChangesOnCart()}if(manageBooking.productSummary!==undefined){rhs.init()}$("#Cars").removeClass("hidden")}else{$("#mmbw-booked-cars .booked-items").html("");$("#mmbw-booked-cars").fadeOut("slow");$("#added-mmbw-cars-summary").fadeOut("slow",function(){$("#added-car-mesage").fadeOut("slow")})}$("#mmbw-booked-cars .wait-image").fadeOut("slow")}else{$("#Cars").addClass("cars");$("#Cars").removeClass("extras-confirmation");$("#CarSearch").removeClass("hidden");$("#booked-cars").removeClass("hidden");carBooked="False";rhs.updateSummary($(".cars"))}jetstarAncillary.carsLoaded();jetstarAncillary.enableContinue()}function CarsLoading(){$("#Cars").addClass("loading");$("#Cars").removeClass("no-results");var isMmbw=$("#main").hasClass("mmbw-cars");if(isMmbw){$("#Cars").removeClass("hidden");$("#mmbw-booked-cars .booked-items").addClass("hidden");$("#mmbw-booked-cars div.wait-image").fadeIn("slow")}else{$("#Cars").addClass("cars")}}function SearchHotels(checkinDate,checkoutDate){if(checkinDate!=undefined&&checkoutDate!=undefined){jetstarAncillary.disableContinue();var minRange=$(".slider").attr("newminprice");var maxRange=$(".slider").attr("newmaxprice");fields={checkinDate:checkinDate,checkoutDate:checkoutDate,minRange:minRange,maxRange:maxRange};if(getURLParameter("tcvalidxml")!=null){fields.tcvalidxml=getURLParameter("tcvalidxml")}DoAjaxCall("GET","Hotel.aspx",fields,"html","Hotels",HotelsLoading,HotelsDisplayedSuccess,undefined,tcAjaxCallError)}else{DoAjaxCall("GET","Hotel.aspx",location.search.substring(1),"html","Hotels",HotelsLoading,HotelsDisplayedSuccessInit,undefined,tcAjaxCallError)}}function HotelsLoading(){if(jetstarBookings.getCulture()!=undefined&&jetstarBookings.getCulture().toLowerCase()=="ja-jp"){$(".price-filter").hide()}$("#Hotels").removeClass("no-results");$("#Hotels").addClass("hotels");$("#Hotels").addClass("loading")}function HotelsDisplayedSuccessInit(){$(".slider").attr("minprice",$("#minprice").attr("minprice"));$(".slider").attr("maxprice",$("#minprice").attr("maxprice"));HotelsDisplayedSuccess()}function HotelsDisplayedSuccess(){var merchandisedProduct=$(".merchandised-product-hotel").data("value"),hasHotelResults=$("#HotelView").length>0;jetstarAncillary.hotelsLoaded();jetstarAncillary.enableContinue();$(".hotels-summary").removeClass("hidden");if(hotelBooked=="True"){$("#Hotels").addClass("extras-confirmation");$("#Hotels").removeClass("hotels");$("#HotelSearch").addClass("hidden");rhs.updateSummary($(".add-hotel"));JetstarAnalyticsTypes.MerchandiseProduct.addMerchandisedProductToDataLayer(merchandisedProduct)}else{if(hasHotelResults==false){$("#Hotels").addClass("no-results");$("#Hotels").removeClass("hotels");$("#Hotels").html($("#hotel-no-result-returned").html());$(".hotels-summary").addClass("hidden")}else{var $copySection=$("#hidden-min-price-section").clone();$copySection.find("dt").replaceWith($("#minprice").val());$(".passenger-section .hotels-caption").html($copySection.html());$(".price-filter").show();JetstarAnalyticsTypes.MerchandiseProduct.addMerchandisedProductToDataLayer(merchandisedProduct)}}$("#Hotels .HotelDescriptions div[sku_id]").remove();Cufon.refresh();ReinitiateValidation("div#Hotels form");RoomEventHandler();setupHotelDescription();setupHotelImages()}function preventDefault(event){try{if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}}catch(err){}}function listContent(data){return'<img src="'+data.imgSrc+'" title="'+data.imgDesc+'"></img>'}function renderToHTMLList(objArrayData,property,listID,listContent){var i,html="";for(i=0;i<objArrayData.length;i++){var obj=objArrayData[i];if(obj){html+="<li>"+listContent(obj)+"</li>"}}html='<ul id="'+listID+'">'+html+"</ul>";return html}function hotelImagesLoadSuccess(data){$("#"+data.targetId+" .contentWrap").html(renderToHTMLList(data.Images,"imgSrc","imageList",listContent));$("#"+data.targetId+" .contentWrap #imageList").galleryView({show_captions:true,panel_width:532,panel_height:400})}function setupHotelImages(){HotelImages.Init({TargetID:"#HotelImagesContainer .contentWrap",OnSuccessfulLoading:onSuccessfulLoading,OnErrorCallback:onError});var href=$(".hotels li#hotel1 .col-right a#HotelImagesLink1").attr("href");if(href){HotelImages.LoadHotelImages(href)}$(".extras-info .extras-info-item .col-right a[data-type='ImagesLink']").overlay({mask:{color:"#000000",loadSpeed:200,opacity:0.7}})}function onError(data){if(data.textStatus!="abort"){$(data.targetID).html('<div class="error-alert" style="display: block;"><h4>['+data.textStatus+'] An unknown error has occurred.</h4></div><input type="hidden" value="'+data.errorThrown+'"/>');jetstarAncillary.carsLoaded();jetstarAncillary.hotelsLoaded();jetstarAncillary.activitiesLoaded();jetstarAncillary.enableContinue()}}function setupHotelImagesHP(){if($("#HotelDetails .hotel-listing").length){HotelImages.Init({TargetID:"#HotelImagesContainer .contentWrap",OnSuccessfulLoading:onSuccessfulLoading,OnErrorCallback:onError});$("#HotelDetails .hotel-listing a[data-type='ImagesLink']").overlay({mask:{color:"#000000",loadSpeed:200,opacity:0.7}}).on("click",function(){var hphref=$(this).attr("href");if(hphref){HotelImages.LoadHotelImages(hphref);$("#HotelImagesContainer").insertAfter($("#exposeMask"))}})}}$(document).ready(function(){setupHotelImagesHP()});function onSuccessfulLoading(data){$(data.TargetID).wrapInner("<div id='gvWrapper'></div>");$(data.TargetID+" #gvWrapper").galleryView({show_captions:true,panel_width:532,panel_height:400})}function setupHotelDescription(){$(".extras-info .extras-info-item .col-right a[data-type='newreadmore']").displayTrigger({displayEffect:1})}function remove_cufon(selector){$(selector).each(function(){var g="";$(this).find("cufon cufontext").each(function(){g=g+$(this).html()});$(this).html(g)});return true}function RoomEventHandler(){$(".extras-info-item .extras-content ul.room-list li input:radio").click(function(){$(this).parents(".extras-info-item").find("span.extras-price").html($(this).attr("price"))})}function HotelSelectedSuccess(){jetstarAncillary.hotelsLoaded();jetstarAncillary.enableContinue();if(!$("#Hotels").hasClass("hotels")){$("#Hotels").addClass("hotels")}$("#Hotels").addClass("extras-confirmation");$("#Hotels").removeClass("hotels");$("#HotelSearch").addClass("hidden");rhs.updateSummary($(".add-hotel"));ShowSelectedHotelImage()}function ShowSelectedHotelImage(){var $selImage=$(".passenger-section #Hotels .booked-item .col-left img");var selectedImageLink=$(".passenger-section").data("selimage");if(($selImage.data("type"))&&(selectedImageLink)&&($selImage.data("type")=="noimage")){$selImage.attr("src",selectedImageLink);$selImage.height($(".passenger-section #Hotels .booked-item .col-right").height())}}function SellHotel(hotelKey,hotelRoomKey){if(typeof(_vis_opt_top_initialize)=="function"){_vis_opt_goal_conversion(200)}jetstarAncillary.disableContinue();SaveSelectedData();var fields=CreatedParams("Hotels","HotelsControlViewHotelView$BookLink");DoAjaxCall("POST","Hotel.aspx",fields,"html","Hotels",HotelsLoading,HotelSelectedSuccess)}function SaveSelectedData(){var selectedRadioButton=$("#Hotels :input:radio:checked");var selectedHotel=selectedRadioButton.parent().parent().data("parent");var selectedImageLink=$("#Hotels #HotelView .tab-container ul.tab-slider li[data-id='"+selectedHotel+"'] img").attr("src");$(".passenger-section").data("selimage",selectedImageLink)}function HotelCancelledSuccess(){$("#Hotels").addClass("hotels");$("#Hotels").removeClass("extras-confirmation");$("#HotelSearch").removeClass("hidden");hotelBooked="False";HotelsDisplayedSuccess();rhs.updateSummary($(".hotels"))}function SearchActivities(UrlPrefix){DoAjaxCall("GET",UrlPrefix+"Activity.aspx",location.search.substring(1),"html","Activities",ActivitiesLoading,ActivitiesDisplayedSuccess,undefined,tcAjaxCallError)}function ActivitiesDisplayedSuccess(bProcessedCancel){var hasActivityResults=$("#ActivityView").length>0;jetstarAncillary.activitiesLoaded();jetstarAncillary.enableContinue();if((typeof bookedActivitiesJSON)!="undefined"){$.each($.parseJSON(bookedActivitiesJSON),function(i,item){$('.activities ul.tab-slider li[itemid="'+item+'"]').addClass("activity-reserved");$('.activities ul.extras-info li[itemid="'+item+'"]').addClass("activity-booked");if(!bProcessedCancel){if(i==$.parseJSON(bookedActivitiesJSON).length-1){$('.activities ul.tab-slider li[itemid="'+item+'"]').click()}}});rhs.updateSummary($(".add-activity"))}ReinitiateValidation("div#Activities form");if(hasActivityResults==false){$("#Activities").addClass("no-results");$("#Activities").removeClass("activities ");$("#Activities").html($("#activity-no-result-returned").html());$(".activities-summary").addClass("hidden")}}function ActivitySelectedSuccess(){ActivitiesDisplayedSuccess(false);rhs.updateSummary($(".add-activity"))}function SellActivity(UrlPrefix,activityControlId,alertMessage){if($("div#Activities div[id*='group'] :input[value!='0']").length===0){alert(alertMessage);return}jetstarAncillary.disableContinue();var fields=CreatedParams("Activities",activityControlId+"$BookLink");DoAjaxCall("POST",UrlPrefix+"Activity.aspx",fields,"html","Activities",ActivitiesLoading,ActivitySelectedSuccess)}function ActivityCancelledSuccess(){ActivitiesDisplayedSuccess(true);$(".activities ul.tab-slider li").first().click();$("#Activities").addClass("activities");rhs.updateSummary($(".activities"))}function ActivitiesLoading(){$("#Activities").addClass("loading")}function SearchTransfers(UrlPrefix){DoAjaxCall("GET",UrlPrefix+"TransferActivity.aspx",location.search.substring(1),"html","Transfers",TransfersLoading,TransfersDisplayedSuccess,undefined,tcAjaxCallError)}function TransfersDisplayedSuccess(bProcessedCancel){jetstarAncillary.transfersLoaded();jetstarAncillary.enableContinue();$(".transfers-summary").removeClass("hidden");if(transferBooked=="True"){$("#Transfers").removeClass("extras-container");$("#Transfers .extras-intro").addClass("hidden");rhs.updateSummary($(".add-transfers"))}else{if(((typeof transferResultsFound)=="undefined"||transferResultsFound!="True")&&getURLParameter("tcvalidxml")==null){$("#Transfers").addClass("no-results");$("#Transfers").removeClass("transfers");$("#Transfers").html($("#transfer-no-result-returned").html())}}ReinitiateValidation("div#Transfers form")}function TransfersSelectedSuccess(){TransfersDisplayedSuccess(true);rhs.updateSummary($(".add-transfers"))}function SellTransfer(UrlPrefix,transferControlId){if($(".dropOffLocationAddress, .pickUpLocationAddress").hasClass("error")){return}jetstarAncillary.disableContinue();$("div#Transfers ul.extras-info li:not(.active-extra) select").each(function(){var input=$(this);input.val("0")});var fields=CreatedParams("Transfers",transferControlId+"$BookLink");DoAjaxCall("POST",UrlPrefix+"TransferActivity.aspx",fields,"html","Transfers",TransfersLoading,TransfersSelectedSuccess)}function TransferCancelledSuccess(){TransfersDisplayedSuccess(false);$("#Transfers").addClass("transfers");rhs.updateSummary($(".transfers"))}function TransfersLoading(){$("#Transfers").addClass("loading")}function cancelCarBooking(pagePrefix,carsControlId,comparisonKey){jetstarAncillary.disableContinue();var fields=CreatedParams("Cars",carsControlId+"$CancelLink");if(comparisonKey&&comparisonKey!=undefined&&comparisonKey.length>0){fields.push({name:"ComparisonKey",value:comparisonKey})}DoAjaxCall("POST",pagePrefix+"Car.aspx",fields,"html","Cars",CarsLoading,CarCancelledSuccess)}function cancelActivityBooking(pagePrefix,activityControlId,cancelItemID){jetstarAncillary.disableContinue();$("#cancelItemID").val(cancelItemID);var fields=CreatedParams("Activities",activityControlId+"$CancelLink");DoAjaxCall("POST",pagePrefix+"Activity.aspx",fields,"html","Activities",ActivitiesLoading,ActivityCancelledSuccess)}function cancelTransferBooking(pagePrefix,transferControlId,cancelItemID){jetstarAncillary.disableContinue();$("div.transfers-confirmation #cancelItemID").val(cancelItemID);$("#Transfers").addClass("extras-container");var fields=CreatedParams("Transfers",transferControlId+"$CancelLink");DoAjaxCall("POST",pagePrefix+"TransferActivity.aspx",fields,"html","Transfers",TransfersLoading,TransferCancelledSuccess)}function cancelHotelBooking(){jetstarAncillary.disableContinue();var fields=CreatedParams("Hotels","HotelsControlViewHotelView$CancelLink");DoAjaxCall("POST","Hotel.aspx",fields,"html","Hotels",HotelsLoading,HotelCancelledSuccess)}function CreatedParams(divIdContainingInputs,eventTargetValue){var fields=$("div#"+divIdContainingInputs+" :input").serializeArray();$.each(fields,function(i,field){var fieldName=field.name.toUpperCase();if(fieldName=="VIEWSTATE"||fieldName=="EVENTTARGET"||fieldName=="EVENTARGUMENT"||fieldName=="PAGETOKEN"){field.name="__"+fieldName}if(fieldName=="EVENTTARGET"){field.value=eventTargetValue}});return fields}function DoAjaxCall(requestType,url,data,dataType,divIdForResponse,preCallFunctionName,successFunctionName,completeFunctionName,errorFunctionName){if(preCallFunctionName!=undefined){preCallFunctionName()}$.ajax({type:requestType,url:url,data:data,dataType:dataType,timeout:60000,success:function(data){if(dataType.toUpperCase()=="JSON"){if(successFunctionName!=undefined){data.targetId=divIdForResponse;successFunctionName(data)}}else{$("#"+divIdForResponse).html(data);if(successFunctionName!=undefined){successFunctionName()}}},error:function(jqXHR,textStatus,errorThrown){if(errorFunctionName!=undefined){errorFunctionName($("#"+divIdForResponse),textStatus,errorThrown)}else{fatalError()}},complete:function(){if(completeFunctionName!=undefined){completeFunctionName()}}})}function fatalError(){alert("An unknown error has occurred.");jetstarAncillary.carsLoaded();jetstarAncillary.hotelsLoaded();jetstarAncillary.activitiesLoaded();jetstarAncillary.enableContinue()}function tcAjaxCallError(container,textStatus,errorThrown){container.html('<div class="error-alert" style="display: block;"><h4>['+textStatus+'] An unknown error has occurred.</h4></div><input type="hidden" value="'+errorThrown+'"/>');jetstarAncillary.carsLoaded();jetstarAncillary.hotelsLoaded();jetstarAncillary.activitiesLoaded();jetstarAncillary.enableContinue();var isMmbw=$("#main").hasClass("mmbw-cars");if(isMmbw){$("#mmbw-booked-cars .wait-image").fadeOut("slow")}}function ReinitiateValidation(formTarget){$(formTarget).validate({onkeyup:false,focusInvalid:false,ignore:".ignore"})}function popupRS(url,w,h){var w=window.open(url,"winpop","scrollbars, resizable=yes, height="+h+", width="+w)}function getURLParameter(name){return decodeURIComponent((new RegExp("[?|&]"+name+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null};