var jetstarLivePerson=(function(){var module=$("head").attr("class"),host=window.location.hostname,isProd="",pageName="",errors="";var objConversionStage=[{conversionStageValue:"1",conversionPageName:["HPSelect.aspx","Select.aspx","Bndl1-Select.aspx","Bndl2-Select.aspx"]},{conversionStageValue:"2",conversionPageName:["Passenger.aspx","HPPassenger.aspx"]},{conversionStageValue:"3",conversionPageName:["Seats.aspx","HPPayment.aspx"]},{conversionStageValue:"4",conversionPageName:["Addons.aspx","Extras.aspx"]},{conversionStageValue:"5",conversionPageName:["Pay.aspx","Payment.aspx"]}];return{init:function(){var enableLivePerson=this.getURLparameters("liveperson");this.checkProd();this.getPageName();if((typeof lpVariable!="undefined"||typeof lpHPVariable!="undefined")&&(enableLivePerson=="true"||isProd=="True")){this.sendLPErrorVariable();this.sendLPConversionStage();if(module=="SB"){this.sendLPvariableSB()}if(module=="HP"){this.sendLPVariableHP()}this.mtagPreload();this.getBundleItemCheckboxToggle();this.getBaggageItemToggle();this.getInsuranceItemToggle();this.getStarKidsItemToggle();this.getCOItemToggle()}},sendLPConversionStage:function(){$.each(objConversionStage,function(){if((jQuery.inArray(pageName,this.conversionPageName)!=-1)==true){lpAddVars("page","ConversionStage",this.conversionStageValue)}})},sendLPvariableSB:function(){lpAddVars("page","Flights-Section",lpVariable.flightsSection);lpAddVars("page","Flights-PointOfSaleLocation",lpVariable.flightsPointOfSaleLocation);if(pageName!="Search.aspx"&&pageName!="SessionExpired.aspx"){lpAddVars("page","Flights-Origin",lpVariable.flightsOrigin);lpAddVars("page","Flights-AirportDestination",lpVariable.flightsAirportDestination);lpAddVars("page","Flights-DepartureDate",lpVariable.flightsDepartureDate);lpAddVars("page","Flights-ReturnDate",lpVariable.flightsReturnDate);lpAddVars("page","Flights-OutboundFlight",lpVariable.flightsOutboundFlight);lpAddVars("page","Flights-InboundFlight",lpVariable.flightsInboundFlight);lpAddVars("page","Flights-Adults",lpVariable.flightsAdult);lpAddVars("page","Flights-Infants",lpVariable.flightsInfant);lpAddVars("page","Flights-Children",lpVariable.flightsChildren);lpAddVars("page","Flights-BaggageSelected",lpVariable.flightsBaggageSelected);lpAddVars("page","Flights-BundleSelected",lpVariable.flightsBundleSelected);lpAddVars("page","Flights-DestinationLocation",lpVariable.flightsDestinationLocation);lpAddVars("page","Flights-DurationDays",lpVariable.flightsDurationDays);lpAddVars("page","Flights-NoProducts",lpVariable.flightsNoProducts);lpAddVars("page","Flights-CartTotal",lpVariable.flightsCartTotal);lpAddVars("page","Flights-CartFlight_BaseFeesTaxes",lpVariable.flightsCartFlight_BaseFeesTaxes);lpAddVars("page","Flights-CartAllAncillary",lpVariable.flightsCartAllAncillary)}if(pageName!="Search.aspx"&&pageName!="Select.aspx"&&pageName!="Bndl1-Select.aspx"&&pageName!="Bndl2-Select.aspx"&&pageName!="Bndl3-Select.aspx"&&pageName!="Bndl4-Select.aspx"&&pageName!="SessionExpired.aspx"){lpAddVars("page","Flights-FlightClass",lpVariable.flightsFlightClass);lpAddVars("page","Flights-FFMember",lpVariable.flightsFFmember)}if(pageName!="Search.aspx"&&pageName!="Select.aspx"&&pageName!="Passenger.aspx"&&pageName!="SessionExpired.aspx"){lpAddVars("page","Flights-HotelBooked",lpVariable.flightsHotelBooked);lpAddVars("session","Flights-HotelName",lpVariable.flightsHotelName);lpAddVars("page","Flights-InsuranceBooked",lpVariable.flightsInsuranceBooked);lpAddVars("page","Flights-CarBooked",lpVariable.flightsCarBooked);lpAddVars("page","Flights-ActivitiesBooked",lpVariable.flightsActivitiesBooked);this.getTCAvailability()}if(pageName=="Itinerary.aspx"||pageName.toLowerCase()=="htl2-itinerary.aspx"){lpAddVars("page","Flights-PNR",$("#pnr_number").val());lpAddVars("page","Flights-BookingCurrency",$("#booking_currency").val());lpAddVars("page","Flights-OrderTotal",lpVariable.flightsOrderTotal);lpAddVars("page","Flights-AncillaryTotal",lpVariable.flightsAncillaryTotal);lpAddVars("page","Flights-OrderConfirmed",$("#order_confirmed").val());lpAddVars("page","Flights-PaymentStatus",lpVariable.flightsPaymentStatus);lpAddVars("page","Flights-FlightTotal",lpVariable.flightsFlightTotal)}},sendLPVariableHP:function(){lpAddVars("page","Holidays-Section",lpHPVariable.holidaysSection);if(pageName!="Search.aspx"&&pageName!="SessionExpired.aspx"){lpAddVars("page","Holidays-Origin",lpHPVariable.holidaysOrigin);lpAddVars("page","Holidays-OutboundFlight",lpHPVariable.holidaysOutboundFlight);lpAddVars("page","Holidays-InboundFlight",lpHPVariable.holidaysInboundFlight);lpAddVars("page","Holidays-HotelName",lpHPVariable.holidaysHotelName);lpAddVars("page","Holidays-RoomCategory",lpHPVariable.holidaysRoomCategory);lpAddVars("page","Holidays-HotelDestination",lpHPVariable.holidaysHotelDestination);lpAddVars("page","Holidays-CartTotal",lpHPVariable.holidaysCartTotal);lpAddVars("page","Holidays-Adults",lpHPVariable.holidaysAdult);lpAddVars("page","Holidays-Infants",lpHPVariable.holidaysInfant);lpAddVars("page","Holidays-Children",lpHPVariable.holidaysChildren);lpAddVars("page","Holidays-AirportDestination",lpHPVariable.holidaysAirportDestination);lpAddVars("page","Holidays-DepartureDate",lpHPVariable.holidaysDepartureDate);lpAddVars("page","Holidays-ReturnDate",lpHPVariable.holidaysReturnDate);lpAddVars("page","Holidays-DurationDays",lpHPVariable.holidaysDurationDays);lpAddVars("page","Holidays-Theme",lpHPVariable.holidaysRoomCategory);lpAddVars("page","Holidays-Carbooked",lpHPVariable.holidaysCarBooked);lpAddVars("page","Holidays-ActivitiesBooked",lpHPVariable.holidaysActivitiesBooked)}if(pageName=="HPItinerary.aspx"){lpAddVars("page","Holidays-PNR",$("#pnr_number").val());lpAddVars("page","Holidays-PaymentStatus",lpHPVariable.holidaysPaymentStatus);lpAddVars("page","Holidays-OrderTotal",lpHPVariable.holidaysOrderTotal);lpAddVars("page","Holidays-FlightTotal",lpHPVariable.holidaysFlightTotal);lpAddVars("page","Holidays-AncillaryTotal",lpHPVariable.holidaysAncillaryTotal);lpAddVars("page","Holidays-CarTotal",lpHPVariable.holidaysCarTotal);lpAddVars("page","Holidays-ActivityTotal",lpHPVariable.holidaysActivityTotal);lpAddVars("page","Holidays-HotelTotal",lpHPVariable.holidaysHotelTotal);lpAddVars("page","Holidays-InsuranceTotal",lpHPVariable.holidaysInsuranceTotal);lpAddVars("page","Holidays-OrderConfirmed",$("#order_confirmed").val());lpAddVars("page","Holidays-BookingCurrency",$("#booking_currency").val())}},sendLPErrorVariable:function(){$("#errorSectionContent> p").each(function(i){errors+=$(this).text()});var errorWrapper=$('.error-message:visible:not(".error-message-short")'),errorCount=errorWrapper.size(),errorMessage=errorWrapper.find("p").text();if(errorMessage!=""){lpAddVars("page","ErrorName",errorMessage);lpAddVars("page","ErrorCounter",errorCount)}if(errors!=""){lpAddVars("page","ErrorName",errors);lpAddVars("page","ErrorCounter",$("#errorSectionContent> p").size())}else{lpAddVars("page","ErrorName","");lpAddVars("page","ErrorCounter",0)}},getBundleItemCheckboxToggle:function(){$(".field.starter-plus").click(function(){if($(this).find("input").is(":checked")){lpAddVars("page","Flights-ItemToggle","PlusValueBundle-On")}else{lpAddVars("page","Flights-ItemToggle","PlusValueBundle-Off")}});$(".field.max-yes").click(function(){if($(this).find("input").is(":checked")){lpAddVars("page","Flights-ItemToggle","MaxValueBundle-On")}else{lpAddVars("page","Flights-ItemToggle","MaxValueBundle-Off")}})},getCardBundleItemCheckboxToggle:function(elem){isStarter=elem.hasClass("starter-plus-yes"),isMax=elem.hasClass("starter-max-yes");if(elem.is(":checked")){if(isStarter){lpAddVars("page","Flights-ItemToggle","PlusValueBundle-On")}else{if(isMax){lpAddVars("page","Flights-ItemToggle","MaxValueBundle-On")}}}else{if(isStarter){lpAddVars("page","Flights-ItemToggle","PlusValueBundle-Off")}else{if(isMax){lpAddVars("page","Flights-ItemToggle","MaxValueBundle-Off")}}}},getBaggageItemToggle:function(){$(".add-baggage-all").change(function(){if($(this).val()=="none"){lpAddVars("page","Flights-ItemToggle","CheckedBaggage-Off")}else{lpAddVars("page","Flights-ItemToggle","CheckedBaggage-On")}})},getInsuranceItemToggle:function(){$('input[name="ControlGroupAddonsView$InsuranceAvailabilityAddonsView$jetcover"]').click(function(){if($(this+":checked").val()=="jetcoverNo"){lpAddVars("page","Flights-ItemToggle","TravelInsurance-Off")}else{lpAddVars("page","Flights-ItemToggle","TravelInsurance-On")}})},getStarKidsItemToggle:function(){var starkidsPayWrap=$("#jetstar_payment_control .starkids");starkidsPayWrap.find("a").click(function(){if($(this).parents("dd").hasClass("hiddenAlert")==false){lpAddVars("page","Flights-ItemToggle","Donation-On")}else{lpAddVars("page","Flights-ItemToggle","Donation-Off")}})},getCOItemToggle:function(){$('input[name="ControlGroupPayView$CarbonOffsetPayView$CarbonRadioGroup"]').click(function(){if($(this).val()=="carbon_buy"){lpAddVars("page","Flights-ItemToggle","CarbonOffset-On")}else{lpAddVars("page","Flights-ItemToggle","CarbonOffset-Off")}})},getTCAvailability:function(){$.ajaxSetup({cache:false});if($("#Hotels").length){$.ajax("Hotel.aspx").done(function(){if($("#Hotels").find(".no-results").length>0){lpAddVars("page","Flights-HotelAvailable","False")}else{lpAddVars("page","Flights-HotelAvailable","True")}})}else{lpAddVars("page","Flights-HotelAvailable","False")}if($("#Activities").length){$.ajax("Activity.aspx").done(function(){if($("#Activities").find(".no-results").length>0){lpAddVars("page","Flights-ActivityAvailable","False")}else{lpAddVars("page","Flights-ActivityAvailable","True")}})}else{lpAddVars("page","Flights-ActivityAvailable","False")}if($("#Cars").length){$.ajax("Car.aspx").done(function(){if(($("#Cars").find(".no-results").length>0)||$("#CarView").length==0){lpAddVars("page","Flights-CarAvailable","False")}else{lpAddVars("page","Flights-CarAvailable","True")}})}else{lpAddVars("page","Flights-CarAvailable","False")}},getURLparameters:function(para){para=para.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+para+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null){return""}else{return results[1]}},checkProd:function(){var prodHostName=["booknow.jetstar.com","book.jetstar.com"];var isProdHost=jQuery.inArray(host,prodHostName);isProd=isProdHost!=-1?"True":"False"},getPageName:function(){var url=document.URL;var lastIndex=(url.indexOf("?")==-1)?url.length:url.indexOf("?");pageName=url.slice(url.lastIndexOf("/")+1,lastIndex)},mtagPreload:function(){if(typeof(lpMTagConfig.lpTagLoaded)!="undefined"&&(!lpMTagConfig.lpTagLoaded)){lpMTagConfig.sendCookies=false;lpAddMonitorTag();lpMTagConfig.lpTagLoaded=true}}}})();$(document).ready(function(){jetstarLivePerson.init()});