jetstarFares=(function(){var debug=false;var isIE6=false;var isIE=false;function togglePriceLockDisplay(isVisible){switch(PriceLockVersion){case 1:if(isVisible){$("#price-lock-section").show()}else{$("#price-lock-section").hide()}break;case 2:if(isVisible){priceLockControlV2.Show()}else{priceLockControlV2.Hide()}break}}return{init:function(){if($("html").hasClass("ie6")){isIE6=true;this.zIndexReset()}if($(".fare-picker").length>0&&typeof jetstarLowFares=="undefined"){this.equalizeRowHeights();this.equalizeOptionalBundleHeights();this.initFareTotalToggle();this.airportInfoTooltipHandler();this.flightDetailTooltipHandler();this.businessCabinTooltipHandler();this.fareInclusionsTooltipHandler();this.fareOptionsEventHandler();this.hotelSelectHandler();this.starterBaggageRequiredHandler();this.autoRestore();this.starterOptBundleSelectHandler();this.upgradeButtonHandler();this.businessOptBundleSelectHandler();this.flightInWindow();jetstarFares.validateImportantInfo();jetstarFares.checkSufficientInfantAvailability();this.bookingErrors();this.setCarrier();this.initPriceLock();this.initToggleFeeTaxBreakdown();this.populateModalHeader();this.initCTARevampBundleAdd();this.bookingInfoTipHandler();this.modalHandler()}$(".fare-option").each(function(){var $obj=$(this);if($obj.find(".approval-disclaimer-dreamliner:visible").length>0){$obj.find(".approval-disclaimer-dreamliner-legend").removeClass("hidden")}if($obj.find(".approval-disclaimer:visible").length>0){$obj.find(".approval-disclaimer-legend").removeClass("hidden")}})},Submit:function(){$(".change-flight .btn-continue, .fares .btn-continue").click()},initImportantInfo:function(){var running=false;$("#important-info .menu a").click(function(e){e.preventDefault();var id=$(this).attr("href");$("#important-info .menu li.active").removeClass("active");$(this).parent("li").addClass("active");$("#important-info dl.active").hide();$(this).removeClass("active");$(id).show().addClass("active")})},zIndexReset:function(){var $divs=$("#main").children("div");var startingZ=200;$divs.each(function(){$(this).css({"z-index":startingZ,position:"relative"});startingZ--})},setCookie:function(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+((exdays==null)?"":"; expires="+exdate.toUTCString());document.cookie=c_name+"="+c_value},getCookie:function(c_name){var i,x,y,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name){return unescape(y)}}},initFareTotalToggle:function(){$("#main .summary .bubble thead th").click(function(e){e.preventDefault();$this=$(this);$this.parents(".bubble").find("table").removeClass("open").addClass("closed");$this.parents("table").removeClass("closed").addClass("open");if(isIE6){$("#booking-summary").css({position:"relative",top:0})}})},equalizeHeights:function(container,selector){var $columns=container.find(selector),maxHeight=0;$columns.each(function(){var height=$(this).height();var childrenHeight=0;$(this).children().each(function(index){childrenHeight+=$(this).outerHeight(true)});if(childrenHeight>height){height=childrenHeight}if(height>0&&height>maxHeight){maxHeight=height}});if(maxHeight>0){$columns.height(maxHeight)}},equalizeOptionalBundleHeights:function(){var maxHeight=0;var tmpHeight=0;$(".fare-picker .fares table tbody").each(function(){$(this).find("tr:even").addClass("alt")})},equalizeRowHeights:function(){var maxHeight=0;var tmpHeight=0;$(".starter-expand .option, .business-expand .option").each(function(){tmpHeight=$("dd",this).height();if(tmpHeight>maxHeight){maxHeight=tmpHeight}});$(".starter-expand .option dd, .business-expand .option dd").css("height",maxHeight);$(".starter-expand, .business-expand").css({display:"none",position:"relative",visibility:"visible"})},bookingInfoTipHandler:function(){$(".impt-info-tip").tooltip({position:"bottom center",offset:[0,-68],relative:true,predelay:250,delay:400})},airportInfoTooltipHandler:function(){var i=0;$(".fare-picker").each(function(){var $this=$(this);var direction="depart";if($this.hasClass("return")){direction="return"}$("."+direction+" .trigger-airport-info").wrapInner("<span>");$("."+direction+" .trigger-airport-info").each(function(){i++;var $tip=$(this);$tip.after('<div id="tooltip-airport-info-'+direction+"-"+i+'" class="tooltip-fares tooltip-airport-info-tip"></div>')});$("."+direction+" .trigger-airport-info").tooltip({position:"bottom right",offset:[0,0],relative:true,predelay:400,delay:500,onBeforeShow:function(e){var offsetHeight=-115,offsetWidth=0,conf=this.getConf(),trigger=this.getTrigger(),id=trigger.attr("rel");offsetHeight=offsetHeight-trigger.height();offsetWidth=offsetWidth-(trigger.width()-trigger.find("span").width())+8;conf.offset=[offsetHeight,offsetWidth];this.getTip().html($(id).html())}})})},flightDetailTooltipHandler:function(){$(".trigger-flight-detail").wrapInner("<span>");$(".trigger-flight-detail").tooltip({position:"bottom center",offset:[0,-50],relative:true,predelay:400,delay:500})},businessCabinTooltipHandler:function(){$(".trigger-business-cabin").tooltip({position:"bottom center",offset:[-96,315],relative:true,predelay:400,delay:500});$(".trigger-cabin-availability").tooltip({position:"bottom center",offset:[0,-64],relative:true,predelay:400,delay:500})},fareInclusionsTooltipHandler:function(){var minHeight=0;var tmpHeight=0;$(".fare-picker").each(function(){var $this=$(this),timer,endTimer,hovering=false,direction="depart";if($this.hasClass("return")){direction="return"}var $tip=$("#tooltip-fare-inclusions-"+direction);$("#tooltip-fare-inclusions-"+direction+" div").each(function(){var tmpHeight=$(this).height();if(tmpHeight>minHeight){minHeight=tmpHeight}});$("#tooltip-fare-inclusions-"+direction+" div").height(minHeight);$("#tooltip-fare-inclusions-"+direction).css({display:"none",position:"relative",visibility:"visible"});$("."+direction+" .trigger-fare-inclusions").mouseenter(function(){var $trigger=$(this),tipPos=$trigger.position(),offset=[];if($trigger.parent().hasClass("business")){offset=[12,160]}else{offset=[12,12]}if(timer){clearTimeout(timer);timer=null}timer=setTimeout(function(){$tip.bind("mouseenter",function(){hovering=true});$tip.bind("mouseleave",function(){hovering=false;closeTip()});hovering=true;$tip.css({top:tipPos.top+offset[0],left:tipPos.left-offset[1],position:"absolute"}).show()},400)});$("."+direction+" .trigger-fare-inclusions").mouseleave(function(){hovering=false;closeTip()});function closeTip(){if(timer){clearTimeout(timer);timer=null}endTimer=setTimeout(function(){if(!hovering){$tip.fadeOut(0);$tip.unbind("mousenter");$tip.unbind("mouseleave")}},500)}})},fareOptionsEventHandler:function(){var tmpOptionsHTML="",currentRadio="",oneway=false;if($(".oneway").length>0){oneway=true}function radioTrigger(trigger){var item="fares",type="starter",direction="depart",$this=trigger,$hotels=$(".fare-option .hotel-listing"),preselectedBundle="",bHotels=false,departingFare,returningFare,$upgradeContainer,isC3=($("div.C3").length>0)?true:false,retainedDepartureMarket=$("#retainedDepartureMarket").val(),retainedReturnMarket=$("#retainedReturnMarket").val();$(document).trigger("FlightOptions.OnFlightSelected");if($hotels.length>0){bHotels=true}if($this.parents("td").hasClass("business")){type="business"}if($this.parents(".fare-picker").hasClass("return")){direction="return"}if($this.attr("preselected-bundle")){preselectedBundle=$this.attr("preselected-bundle")}var clubPromoDiscDiv=$this.parents(".fare-picker").find(".business-expand .club-promo-fare-disc");if($this.parents(".field").hasClass("club-promo-fare")){xxx=$this;clubPromoDiscDiv.show()}else{clubPromoDiscDiv.hide()}setTimeout((function(){if($("#selected-flights-summary").find(".dreamliner-logo.legend").length>0){$("#selected-flights-summary .small-light-note").show()}else{$("#selected-flights-summary .small-light-note").hide()}}),500);$this.parents("table").addClass("focus");$(".focus td.business").removeClass("business-select");$(".focus td.starter").removeClass("starter-select");$(".focus .business-options td").hide();$(".focus .starter-options td").hide();var bundleLayout=$(".fare-picker .bundle-cards input.checkbox").size();if(bundleLayout>0){jetstarFares.setOptionalBundleCardFields($this,type,preselectedBundle)}else{jetstarFares.setOptionalBundleFields($this,type,preselectedBundle)}tmpOptionsHTML=$(".focus ."+type+"-options");$(".focus ."+type+"-options").detach();$this.parents("td."+type).addClass(type+"-select");$this.parents("tr").after(tmpOptionsHTML);$this.parents("table").find("tr").removeClass("active-flight");$this.parents("tr").addClass("active-flight");$this.parents("tr.active-flight").next().removeClass("alt");$(".focus ."+type+"-options td").show();$("table.focus").removeClass("focus");if(type=="business"&&($this.parents(".business-select").find(".different-cabins").length>0)){$(".seat-notification").show();$(".notice").show()}else{$(".seat-notification").hide();$(".notice").hide()}$upgradeContainer=$("."+direction+" .starter-upgrade-yes").parents(".promo");if(type=="starter"&&$this.parents("tr").find(".business input:radio").length>0){$upgradeContainer.show()}else{if(type=="starter"){$upgradeContainer.hide()}}if($(".card-inner").length>0){jetstarFares.newSaleBannerToggle($this)}else{jetstarFares.oldSaleBannerToggle($this)}jetstarFares.equalizeHeights(tmpOptionsHTML,".bundle-cards .card-inner dl");jetstarFares.moveSummaryBubble($this.parents("table"));if(direction=="depart"){$(".bubble .departing table").removeClass("closed").addClass("open");$(".bubble .returning table").removeClass("open").addClass("closed")}else{if(direction=="return"){$(".bubble .returning table").removeClass("closed").addClass("open");$(".bubble .departing table").removeClass("open").addClass("closed")}}$(".fare-option .fare-picker .summary .cta").hide();$(".fare-option .fare-picker .summary .bubble").fadeIn();var $bookingSummary=$("#booking-summary"),$flightSummary=$this.parents("tr").find(".flight-summary-details").clone();if(bHotels){$flightSummary.find(".price").remove()}$bookingSummary.find("."+direction+"ing .details").replaceWith($flightSummary);$bookingSummary.find("."+direction+"ing .flight-summary-details").removeClass("flight-summary-details");$bookingSummary.find("."+direction+"ing ."+type).show().siblings(".fare-cabin").hide();departingFare=$(".fare-option .depart .starter, .fare-option .depart .business").find("input:radio:checked");returningFare=$(".fare-option .return .starter, .fare-option .return .business").find("input:radio:checked");if(departingFare.length>0&&returningFare.length>0||departingFare.length>0&&(oneway||retainedReturnMarket=="true")||returningFare.length>0&&(oneway||retainedDepartureMarket=="true")||isC3&&retainedDepartureMarket=="false"&&retainedReturnMarket=="false"&&(departingFare.length>0||returningFare.length>0)){jetstarFares.validateImportantInfo();if($(".important-info-box").length==0||$(".important-info-box").hasClass("hide")||$("#summary-user-acknowledge-checkbox:checked").length>0){$bookingSummary.find(".btn-continue").removeClass("disabled");$(".important-info-modal").removeClass("overlay-disabled")}else{$bookingSummary.find(".btn-continue").addClass("disabled");$(".important-info-modal").addClass("overlay-disabled")}}$this.parents("table").find("td.bundle-cards").find("input:checked").each(function(){if(!$(this).hasClass("business-max-yes")){$(this).prop("checked",false);$(this).change()}});jetstarFares.togglePriceLock();jetstarFares.importantInfoPopup();jetstarFares.updatePriceSummary($this,item,direction);if(typeof checkErrors=="function"){checkErrors()}if($(".currency").text().toLowerCase().indexOf("points")<0){var redirection=direction+"ing";var taxBreakdownAdt=$("."+redirection+" .fees-adult-free");var taxBreakdownChd=$("."+redirection+" .fees-child-free");var currPrefix=$(".total-price .details .price").attr("data-currency-prefix");var i=1;$("."+redirection+"-adt-fee").remove();$("."+redirection+"-chd-fee").remove();while(true){if(typeof trigger.attr("fee-code-adt"+i)!="undefined"||typeof trigger.attr("fee-code-chd"+i)!="undefined"){if(typeof trigger.attr("fee-code-adt"+i)!="undefined"){taxBreakdownAdt.after('<tr class="'+redirection+"-adt-fee fees-breakdown"+i+'"></tr>');$("."+redirection+"-adt-fee.fees-breakdown"+i).append("<th>"+(trigger.attr("fee-desc-adt"+i)?trigger.attr("fee-desc-adt"+i):trigger.attr("fee-code-adt"+i))+"</th>");$("."+redirection+"-adt-fee.fees-breakdown"+i).append("<td><span>"+currPrefix+currencyConverter.formatCurrency($("#RHS").data("currency"),currencyConverter.formatFloat(trigger.attr("fee-amount-adt"+i)))+"</span></td>")}if(typeof trigger.attr("fee-code-chd"+i)!="undefined"){taxBreakdownChd.after('<tr class="'+redirection+"-chd-fee fees-breakdown"+i+'"></tr>');$("."+redirection+"-chd-fee.fees-breakdown"+i).append("<th>"+(trigger.attr("fee-desc-chd"+i)?trigger.attr("fee-desc-chd"+i):trigger.attr("fee-code-chd"+i))+"</th>");$("."+redirection+"-chd-fee.fees-breakdown"+i).append("<td><span>"+currPrefix+currencyConverter.formatCurrency($("#RHS").data("currency"),currencyConverter.formatFloat(trigger.attr("fee-amount-chd"+i)))+"</span></td>")}i++}else{break}}$("."+redirection+"-adt-fee").hide();$("."+redirection+"-chd-fee").hide()}}$("td.starter, td.business").bind("click",function(e,primed){var hasRadio=$(this).find("input:radio");if((hasRadio).length==1&&hasRadio.prop("checked")==false&&!primed){hasRadio[0].checked=true;radioTrigger(hasRadio)}$(this).parent(".active-flight").next().find(".plus").each(function(){var priceLength=$(this).find(".brandDemi").text().length,priceVal=$(".starter-options .card-top").find(".brandDemi");if(priceLength>7){priceVal.addClass("long-nominals");if(window.Cufon!=undefined){Cufon.replace(".card-top .brandDemi")}}})});$("td.starter input:radio, td.business input:radio").click(function(e){radioTrigger($(this));jetstarFares.validateImportantInfo()});$("td.starter, td.starter input:radio, td.business, td.business input:radio").on("click",function(){$(this).parents(".fare-option").find(".fare-picker .starter-options div.btn-is-selected:visible").hide()});$($("td.starter input:checked, td.business input:checked").get().reverse()).each(function(){radioTrigger($(this))});if($("html").hasClass("ie6")||$("html").hasClass("ie7")||$("html").hasClass("ie8")){$("label input").each(function(){var $parent=$(this).closest("label"),attrFor=$parent.attr("for");if(typeof attrFor!=="undefined"&&attrFor.length<=0){$parent.click(function(e){var $input=$(this).children("input");if($input.is(":checked")){$input.prop("checked",false).trigger("change")}else{$input.prop("checked","checked").trigger("change")}})}})}$($('.depart td.starter input[preselected-fare="True"]:first, .return td.starter input[preselected-fare="True"]:first, .depart td.business input[preselected-fare="True"]:first, .return td.business input[preselected-fare="True"]:first').get().reverse()).each(function(){$(this).prop("checked",true);radioTrigger($(this))});$($(".depart input[type=checkbox ]:disabled, .return input[type=checkbox]:disabled").get().reverse()).each(function(){if($(this).prop("disabled")!=true&&$(this).is(":visible")&&$(this).attr("preselected-fare")=="True"&&$(this).attr("checked")!="checked"){$(this).prop("checked",true);$(this).trigger("click",["primed"])}})},newSaleBannerToggle:function(selector){var $this=selector,$parentField=$this.parent(".field"),$parentTable=$this.parents("table"),$messageHolder,showGeneralSaleWarning=false;if($this.parents("div.return").length>0){$messageHolder=$this.parents("div.return").find("div.sale-warning-msg")}else{$messageHolder=$this.parents("div.depart").find("div.sale-warning-msg")}if($parentField.siblings(".jquery-sale").length>0){showGeneralSaleWarning=true}else{showGeneralSaleWarning=false}if($parentField.siblings(".jquery-sale-twoforone").length>0){showGeneralSaleWarning=false;$messageHolder.html($parentTable.find(".two-for-one-message").show())}else{$parentTable.find(".two-for-one-message").hide()}if($parentField.siblings(".jquery-sale-bb").length>0){showGeneralSaleWarning=false;$messageHolder.html($parentTable.find(".bulk-buys-message").show())}else{$parentTable.find(".bulk-buys-message").hide()}if($parentField.siblings(".jquery-sale-f4f").length>0){showGeneralSaleWarning=false;$messageHolder.html($parentTable.find(".friend-for-free-message").show())}else{$parentTable.find(".friend-for-free-message").hide()}if($parentField.siblings(".sale-kidsflyfree").length>0){showGeneralSaleWarning=false;$messageHolder.html($parentTable.find(".kids-fly-free-message").show());$parentTable.find(".kids-fly-free-message").addClass("kff-max-visible");$parentTable.find(".option.right").hide()}else{$parentTable.find(".kids-fly-free-message").hide();$parentTable.find(".kids-fly-free-message").removeClass("kff-max-visible");$parentTable.find(".option.right").show()}if(showGeneralSaleWarning){$messageHolder.html($parentTable.find(".sale-message").show())}else{$parentTable.find(".sale-message").hide()}},oldSaleBannerToggle:function(selector){var $this=selector;var showGeneralSaleWarning=false;if($this.parent(".field").siblings(".jquery-sale").length>0){showGeneralSaleWarning=true}else{showGeneralSaleWarning=false}if($this.parent(".field").siblings(".jquery-sale-twoforone").length>0){showGeneralSaleWarning=false;$this.parents("table").find(".two-for-one-message").show()}else{$this.parents("table").find(".two-for-one-message").hide()}if($this.parent(".field").siblings(".jquery-sale-f4f").length>0){showGeneralSaleWarning=false;$this.parents("table").find(".friend-for-free-message").show()}else{$this.parents("table").find(".friend-for-free-message").hide()}if($this.parent(".field").siblings(".sale-kidsflyfree").length>0){showGeneralSaleWarning=false;$this.parents("table").find(".kids-fly-free-message").show();$this.parents("table").find(".kids-fly-free-message").addClass("kff-max-visible");$this.parents("table").find(".option.right").hide()}else{$this.parents("table").find(".kids-fly-free-message").hide();$this.parents("table").find(".kids-fly-free-message").removeClass("kff-max-visible");$this.parents("table").find(".option.right").show()}if(showGeneralSaleWarning){$this.parents("table").find(".sale-message").show()}else{$this.parents("table").find(".sale-message").hide()}},hotelSelectHandler:function(){var $hotels=$(".fare-option .hotel-listing"),checkInDate=$hotels.find(".items").attr("data-checkin"),checkOutDate=$hotels.find(".items").attr("data-checkout"),nights=$hotels.find(".items").attr("data-nights"),hotelName,roomType,checkInYear,checkOutYear,paxPrice,decimalPoints=($(".currency").text().toLowerCase().indexOf("points")>=0||$(".currency").text().toLowerCase().indexOf("vnd")>=0||$(".currency").text().toLowerCase().indexOf("idr")>=0)?0:2,commaDecimal=(Culture=="vi-VN"||Culture=="ms-MY"||Culture=="id-ID")?true:false,d=(commaDecimal)?",":".",t=(commaDecimal)?".":",",paxCount=formatFloat($hotels.find(".items").attr("data-paxcount"));if($(".summary .bubble .hotels-child span").attr("data-kff")!=undefined){paxCount=formatFloat($(".summary .bubble .hotels-child").attr("data-paxcount"))}$("#booking-summary .check-in span").text(checkInDate);$("#booking-summary .check-out span").text(checkOutDate);$("#booking-summary .nights").text(nights);$(".summary .bubble .check-in").text(checkInDate);$(".summary .bubble .check-out").text(checkOutDate);$(".summary .bubble .nights span").text(nights);if($hotels.length>0){$hotels.find("input:radio").click(function(){roomType=$(this).parents("td.select").prev(".desc").find("strong").text();hotelName=$(this).parents("div.item").find("h3.hotelname").text();hotelPrice=formatFloat($(this).attr("data-price"));paxPrice=hotelPrice/paxCount,roomValue=$(this).prop("value"),keys=roomValue.split("KeySeparator");hotelKey=keys[0];roomKey=keys[1];$hotels.find(".hotel-key").prop("value",hotelKey);$hotels.find(".room-key").prop("value",roomKey);$("#booking-summary .hotel-overview .hotel").text(hotelName);$("#booking-summary .room-type").text(roomType);$(".summary .bubble .hotel-name").text(hotelName);$(".summary .bubble .room-type").text(roomType);$(".summary .bubble .hotels-adult span").text(formatCurrency(paxPrice,decimalPoints,d,t));if($(".summary .bubble .hotels-child span").attr("data-kff")=="true"){}else{$(".summary .bubble .hotels-child span").text(formatCurrency(paxPrice,decimalPoints,d,t))}jetstarFares.moveSummaryBubble($(this).parents("table"));if(isIE6){$("#booking-summary").css({position:"relative",top:0})}jetstarFares.updatePriceSummary($(this))})}$hotels.find("input:radio").first().click();$("tr.hotel-rooms.hidden").parents(".item").find(".view-more").show().on("click",function(){$(this).parents(".hotel-row").find("tr.hotel-rooms.hidden").removeClass("hidden");$(this).hide()});function formatFloat(price){var price=(price)?price.toString():"0",priceRe=/[^\d\.-]/g;return parseFloat(price.replace(priceRe,"").replace(",","."))}function formatCurrency(n,c,d,t){var c=isNaN(c=Math.abs(c))?2:c,d=d==undefined?".":d,t=t==undefined?",":t,s=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(c))+"",j=(j=i.length)>3?j%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"")}},updatePriceSummary:function(trigger,item,direction){var $priceSummary=$(".summary .bubble"),$priceSummarySection=$priceSummary.find("."+direction+"ing",".holidays"),$priceSummarySectionTotal=$priceSummarySection.find("tfoot span"),$priceSummaryTotal=$priceSummary.find(".total .price span"),$footerSummaryTotal=$("#booking-summary .total-price .price span"),$footerSummarySectionTotal=$("#booking-summary ."+direction+"ing .price span"),flightDate=$("#booking-summary").find("."+direction+"ing .date-time").first().text(),paxPrice={adult:trigger.attr("data-price"),child:trigger.attr("data-price-chd")?trigger.attr("data-price-chd"):trigger.attr("data-price"),infant:trigger.attr("data-price-inf")?trigger.attr("data-price-inf"):"0"},priceCont="span[data-pax]",sectionCont="tbody td",paxAttr="data-pax",sectionPrice=0,totalPrice=0,paxCountPayable={adult:trigger.attr("data-payable-adult"),child:trigger.attr("data-payable-child")},paxCountUnPayable={adult:trigger.attr("data-unpayable-adult"),child:trigger.attr("data-unpayable-child")},perPaxPrice,paxCount;decimalPoints=($priceSummary.find(".currency").text().toLowerCase().indexOf("points")>=0||$priceSummary.find(".currency").text().toLowerCase().indexOf("vnd")>=0||$priceSummary.find(".currency").text().toLowerCase().indexOf("idr")>=0||$priceSummary.find(".currency").text().toLowerCase().indexOf("jpy")>=0)?0:2;commaDecimal=(Culture=="vi-VN"||Culture=="ms-MY"||Culture=="id-ID")?true:false;d=(commaDecimal)?",":".";t=(commaDecimal)?".":",";if(direction){$.each(paxPrice,function(i,val){if(item=="bundles"&&val>0){basePriceAdjust=parseFloat(trigger.attr("data-price-base-adjust"));if(basePriceAdjust>0){currentBaseFare=parseFloat($priceSummarySection.find(".fares-"+i+" "+priceCont).text());if((trigger.prop("checked")==false)){basePriceAdjust*=-1}$priceSummarySection.find(".fares-"+i+" "+priceCont).text(formatCurrency(currentBaseFare+basePriceAdjust,decimalPoints,d,t))}}})}if((trigger.attr("type")=="checkbox")&&(trigger.prop("checked")==false)&&trigger.parents("td").find("input:checkbox:checked").length==0){paxPrice={adult:"0",child:"0",infant:"0"};paxCountPayable={adult:trigger.attr("base-payable-adult"),child:trigger.attr("base-payable-child")};paxCountUnPayable={adult:trigger.attr("base-unpayable-adult"),child:trigger.attr("base-unpayable-child")}}if(direction){$.each(paxPrice,function(i,val){setPayablePassenger($priceSummarySection,item,i,paxCountPayable[i],paxCountUnPayable[i],priceCont,paxAttr);$priceSummarySection.find("."+item+"-"+i+" "+priceCont).text(formatCurrency(formatFloat(val),decimalPoints,d,t));if(item=="bundles"&&val>0){if($priceSummary.find("th:contains('VAT')").length>0){$priceSummarySection.find("."+item+"-"+i+" "+priceCont).append("*")}}});if($priceSummary.find("span:contains('*')").length>0&&$(".note-VAT").length>0){$(".note-VAT").removeClass("hidden")}else{$(".note-VAT").addClass("hidden")}}if(direction&&$priceSummarySection.find(".fees-adult")){var hideFeesAndTaxHeader=true;var feesAndTaxes=getTotalFees();$.each(feesAndTaxes,function(i,val){if(val==0||val==undefined){$priceSummarySection.find(".fees-"+i).hide()}else{hideFeesAndTaxHeader=false;$priceSummarySection.find(".fees-"+i+" "+priceCont).text(formatCurrency(formatFloat(val),decimalPoints,d,t))}});if(hideFeesAndTaxHeader){$priceSummarySection.find(".fee-and-tax").hide()}else{$priceSummarySection.find(".fee-and-tax").show()}}if(direction){flightDate=flightDate.replace(/,/g,"");$priceSummarySection.find(".date-time").text(flightDate)}if(direction&&$priceSummarySection.length>0){setPayableChildrenForKFF(trigger,direction,item)}$priceSummarySection.find(sectionCont+" "+priceCont).each(function(){if($(this).parent().parent().css("display")!="none"){sectionPrice+=(removeFormat($(this).attr(paxAttr))*removeFormat($(this).text()))}});$priceSummary.find(sectionCont+" "+priceCont).each(function(){if($(this).parent().parent().css("display")!="none"){totalPrice+=removeFormat($(this).attr(paxAttr))*removeFormat($(this).text())}});if($(".fare-option .hotel-listing").length>0){paxCount=formatFloat($(".fare-option .hotel-listing").find(".items").attr("data-paxcount"));perPaxPrice=totalPrice/paxCount;$footerSummaryTotal.parents(".details").find(".per-pax-price span").text(formatCurrency(perPaxPrice,decimalPoints,d,t));setKFFSummaryTotal(trigger,$footerSummaryTotal)}$priceSummarySectionTotal.text(formatCurrency(sectionPrice,decimalPoints,d,t));$priceSummaryTotal.text(formatCurrency(totalPrice,decimalPoints,d,t));$footerSummarySectionTotal.text(formatCurrency(sectionPrice,decimalPoints,d,t));$footerSummarySectionTotal.parent().attr("data-price",totalPrice);$footerSummaryTotal.text(formatCurrency(totalPrice,decimalPoints,d,t));$footerSummaryTotal.parent().attr("data-price",totalPrice);setPriceLockChargeBreakDown(paxCountPayable,totalPrice,decimalPoints,d,t);function formatFloat(price){var price=(price)?price.toString():"0",priceRe=/[^\d\.-]/g;return parseFloat(price.replace(priceRe,"").replace(",","."))}function removeFormat(strPrice){var strPrice=strPrice?strPrice.toString():"0",result=strPrice;if(commaDecimal){result=result.replace(/[^\d\,-]/g,"").replace(",",".")}else{result=result.replace(/[^\d\.-]/g,"")}return parseFloat(result)}function formatCurrency(n,c,d,t){var c=isNaN(c=Math.abs(c))?2:c,d=d==undefined?".":d,t=t==undefined?",":t,s=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(c))+"",j=(j=i.length)>3?j%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"")}function getTotalFees(){var feesAndTaxes={adult:0,child:0,infant:0,"adult-free":0,"child-free":0,"infant-free":0},$selectedFare=$("."+direction+" .fares").find('input[type="radio"]:checked');feesAndTaxes.adult=$selectedFare.attr("data-fees-adt");feesAndTaxes.child=$selectedFare.attr("data-fees-chd");feesAndTaxes["adult-free"]=$selectedFare.attr("data-discfees-adt");feesAndTaxes["child-free"]=$selectedFare.attr("data-discfees-chd");return feesAndTaxes}function setPayablePassenger(section,item,paxtype,countPayable,countUnPayable,priceCont,paxAttr){if((item=="fares"||item=="bundles")&&(paxtype=="adult"||paxtype=="child")&&(countPayable!=undefined&&countUnPayable!=undefined)){var paxCont="span[paxes]",upaxAttr="paxes";var selector=".fares-"+paxtype;setPayableElement(section,selector,priceCont,paxCont,paxAttr,upaxAttr,countPayable);selector=".fares-"+paxtype+"-free";setPayableElement(section,selector,priceCont,paxCont,paxAttr,upaxAttr,countUnPayable);selector=".fees-"+paxtype;setPayableElement(section,selector,priceCont,paxCont,paxAttr,upaxAttr,countPayable);selector=".fees-"+paxtype+"-free";setPayableElement(section,selector,priceCont,paxCont,paxAttr,upaxAttr,countUnPayable)}}function setPayableElement(section,selector,priceCont,paxCont,paxAttr,upaxAttr,amount){section.find(selector).find(priceCont).attr(paxAttr,amount);section.find(selector).find(paxCont).attr(upaxAttr,amount).text(amount);if(amount==0){section.find(selector).hide()}else{section.find(selector).show()}}function setPayableChildrenForKFF(trigger,direction,item){if(item=="fares"||item=="bundles"){var $priceField=$('.summary .bubble .hotels-child span[data-kff="true"][direction="'+direction+'"]');if(trigger.attr("kff-child-pax-ammount")!=undefined&&trigger.attr("kff-child-pax-ammount")>0&&$priceField.length>0){$priceField.attr("data-pax",trigger.attr("data-payable-child")).attr("paid","true").text(trigger.attr("kff-child-pax-ammount"))}else{if($priceField.length>0&&trigger.attr("data-unpayable-child")!=undefined){$priceField.attr("data-pax",trigger.attr("data-unpayable-child")).attr("paid","false").text(0)}}if(item=="bundles"){if($(".kff-max-visible").parent("dd").find("input:checked").length>0){$(".kids-fly-free-disclaimer").show();$(".kids-fly-free-disclaimer").addClass("kids-fly-free-disclaimer-check-recuired")}else{$(".kids-fly-free-disclaimer").hide();$(".kids-fly-free-disclaimer").removeClass("kids-fly-free-disclaimer-check-recuired")}}if(typeof checkErrors=="function"){checkErrors()}}}function setKFFSummaryTotal(trigger,$footerSummaryTotal){if($footerSummaryTotal.parents(".details").find(".per-pax-price-KFF").length==0){return}var $childPaySection=$('.summary .bubble .hotels-child span[data-kff="true"]');var chdCount=0,chdFreeCount=0,chdPay=0,chdExtr=0,adtPrice=0;$('.summary .bubble .hotels-child span[data-kff="true"]').each(function(){if($(this).attr("paid")!=undefined&&$(this).attr("paid")=="true"){chdCount=$(this).attr("data-pax");chdPay+=formatFloat($(this).text())}else{chdFreeCount=$(this).attr("data-pax")}});adtPrice=formatFloat($(".summary .bubble .hotels-adult span").text());$(".summary .bubble .baggage-adult span").each(function(){adtPrice+=formatFloat($(this).text())});$(".summary .bubble .bundles-adult span").each(function(){adtPrice+=formatFloat($(this).text())});$footerSummaryTotal.parents(".details").find(".per-pax-price-KFF .kff-adult span").text(formatCurrency(adtPrice,decimalPoints,d,t));$footerSummaryTotal.parents(".details").find(".per-pax-price-KFF .kff-child").show().siblings(".kff-price").text(formatCurrency(chdPay,decimalPoints,d,t));$(".summary .bubble .baggage-child span").each(function(){chdExtr+=formatFloat($(this).text())});$(".summary .bubble .bundles-child span").each(function(){chdExtr+=formatFloat($(this).text())});if(chdExtr>0){$footerSummaryTotal.parents(".details").find(".per-pax-price-KFF .kff-child-free-opt").show().find(".kff-price").text(formatCurrency(chdExtr,decimalPoints,d,t))}else{$footerSummaryTotal.parents(".details").find(".per-pax-price-KFF .kff-child-free-opt").hide()}}function setPriceLockChargeBreakDown(paxCountPayable,totalPrice,decimalPoints,d,t){var count=0;if(!isNaN(paxCountPayable.adult)){count+=Number(paxCountPayable.adult)}if(!isNaN(paxCountPayable.child)){count+=Number(paxCountPayable.child)}departingFare=$(".fare-option .depart .starter, .fare-option .depart .business").find("input:radio:checked");returningFare=$(".fare-option .return .starter, .fare-option .return .business").find("input:radio:checked");var departurePriceLockCharge=0;var returnPriceLockCharge=0;if(departingFare.length>0){departurePriceLockCharge=departingFare.attr("journey-price-lock-amount");if(isNaN(departurePriceLockCharge)){departurePriceLockCharge=0}}if(returningFare.length>0){returnPriceLockCharge=returningFare.attr("journey-price-lock-amount");if(isNaN(returnPriceLockCharge)){returnPriceLockCharge=0}}var priceLockCharge=count*(Number(departurePriceLockCharge)+Number(returnPriceLockCharge));if(priceLockCharge<1){var priceLockAmountShown=$("#pricelockAmount span").text();if(priceLockAmountShown===undefined||priceLockAmountShown===""){return}priceLockCharge=Number(priceLockAmountShown);if(priceLockCharge<1){return}}var amountDueLater=totalPrice;var totalPriceWithPriceLock=amountDueLater+priceLockCharge;$("#pricelockAmount span").text(formatCurrency(priceLockCharge,decimalPoints,d,t));$("#pricelockSubtotal span").text(formatCurrency(amountDueLater,decimalPoints,d,t));$("#pricelockTotal span").text(formatCurrency(totalPriceWithPriceLock,decimalPoints,d,t))}},autoRestore:function(){jetstarFares.autoRestorePrevSelected("depart");jetstarFares.autoRestorePrevSelected("return")},autoRestorePrevSelected:function(direction){var $baggageSection=$(".fare-option ."+direction+" .baggage-option");var preselectedBaggage=$baggageSection.find("select").attr("preselected");if(preselectedBaggage!=undefined&&preselectedBaggage=="no"){$baggageSection.find("input.baggage-no").prop("checked",true).click()}if(preselectedBaggage!=undefined&&preselectedBaggage.substring(0,2)=="BG"){$baggageSection.find("input.baggage-yes").siblings("select").find('option[value=""]').remove();$baggageSection.find("input.baggage-yes").siblings("select").prop("disabled",false).removeClass("disabled").val(preselectedBaggage).trigger("change")}$(".fare-option ."+direction+' .bundle-option:checkbox[reassigned="true"]').trigger("click",["primed"]);$(".fare-option ."+direction+' .bundle-option:checkbox[maxunchecked="true"]').prop("checked",false).trigger("click").prop("checked",false)},setOptionalBundleFields:function(target,type,preselectedBundle){var isC3=($("div.C3").length>0)?true:false;$bundleContainer=$(".focus ."+type+"-options");$(".focus input.bundle-option:checkbox:checked").prop("checked",false).click().prop("checked",false);$(".focus .baggage-option input:radio:checked").prop("checked",false);$(".focus .baggage-option select").prop("disabled",false).removeClass("disabled").val("0").change();if(type=="business"){$(".focus .baggage-option input:radio.baggage-no").prop("checked",true).click()}target.parents("td").find(".bundle-option").each(function(){var fieldAttributes={id:$(this).attr("id"),name:$(this).attr("name")},$existing=$bundleContainer.find('.bundle-option[class="'+$(this).attr("class")+'"]'),$clone=$(this).clone(false),$parent=$(this),suffix="_off",suffixRe=/_off$/;$.each(fieldAttributes,function(attr,val){var tempStr=val.replace(suffixRe,"");$clone.attr(attr,tempStr);$parent.attr(attr,tempStr+suffix)});$existing.parent().siblings("ul").find(".bundlessritem").remove();$existing.parent().siblings("ul").prepend($parent.siblings(".bundlessr").find(".bundlessritem").clone());if($parent.siblings(".qff-voucher").find("li.qff-voucher-hidden")!=undefined){}$existing.siblings("label").attr("id",fieldAttributes.id);$existing.replaceWith($clone);$bundleContainer.find('.checkbox[class="'+$(this).attr("class")+'"]').parent(".bundle-status").attr("for",fieldAttributes.id)});target.parents("td").find(".bundle-price").each(function(){if($(this).hasClass("starter-plus-yes")){$bundleContainer.find(".cta-bundle-starter-plus-price").text($(this).text());var plusMerchandizingIncludedValue=$bundleContainer.find(".bundle-option.starter-plus-yes").attr("plusMerchandizingIncludedValue");if(plusMerchandizingIncludedValue==0){$bundleContainer.find(".cta-bundle").addClass("hidden")}else{$bundleContainer.find(".cta-bundle").removeClass("hidden");$bundleContainer.find(".cta-bundle-starter-plus-included-value").text(plusMerchandizingIncludedValue)}}$bundleContainer.find('.bundle-price[class="'+$(this).attr("class")+'"]').replaceWith($(this).clone(false))});jetstarFares.bundleCheckboxHandler();jetstarFares.starterBaggageSelectionHandler();if(Culture=="en-US"){$(".focus .baggage-option input:radio.baggage-no").prop("checked",true).click();$(".focus .baggage-option input:radio.radio").prop("checked",false)}else{$bundleContainer.find(".baggage-option input.baggage-yes").prop("checked",true).click()}if(type=="starter"&&preselectedBundle=="PLUS"){$bundleContainer.find("input.starter-plus-yes").trigger("click",["primed"]).prop("disabled",true)}if(type=="starter"&&preselectedBundle=="MAX"){$bundleContainer.find("input.starter-plus-yes").prop("disabled",true);$bundleContainer.find("input.starter-max-yes").trigger("click",["primed"]).prop("disabled",true)}if(type=="business"&&preselectedBundle=="BUSINESS-MAX"){$bundleContainer.find("input.business-max-yes").prop("checked",true).change().prop("disabled",true)}if(type=="business"){$bizBundle=$bundleContainer.find("input.business-max-yes");$bizBundle.siblings("label").attr("for",$bizBundle.attr("id")).removeAttr("id");if(Culture!="en-US"&&!isC3){$bizBundle.not(":checked").trigger("click",["primed"])}}},setOptionalBundleCardFields:function(target,type,preselectedBundle){var isC3=($("div.C3").length>0)?true:false,$bundleContainer=$(".focus ."+type+"-options");$(".focus input.bundle-option:checkbox:checked").prop("checked",false).click().prop("checked",false).change();$(".focus .baggage-option input:radio:checked").prop("checked",false);$(".focus .baggage-option select").prop("disabled",false).removeClass("disabled").val("0").change();if(type=="business"){$(".focus .baggage-option input:radio.baggage-no").prop("checked",true).click()}target.parents("td").find(".bundle-option").each(function(){var fieldAttributes={id:$(this).attr("id"),name:$(this).attr("name")},$existing=$bundleContainer.find('.bundle-option[class="'+$(this).attr("class")+'"]'),$clone=$(this).clone(false),$parent=$(this),suffix="_off",suffixRe=/_off$/;$.each(fieldAttributes,function(attr,val){var tempStr=val.replace(suffixRe,"");$clone.attr(attr,tempStr);$parent.attr(attr,tempStr+suffix)});$existing.parent().siblings("ul").find(".bundlessritem").remove();$existing.parent().siblings("ul").prepend($parent.siblings(".bundlessr").find(".bundlessritem").clone());if($existing.parent().siblings("dl").find(".lounge-def").length>0){if($parent.siblings(".lounge-hidden").length>0){$existing.parent().siblings("dl").find(".lounge-def").show();$existing.parent().siblings("dl").find(".lounge-overlay").show()}else{$existing.parent().siblings("dl").find(".lounge-def").hide();$existing.parent().siblings("dl").find(".lounge-overlay").hide()}}$existing.parents(".card-inner").each(function(){var $existingMealBundle=$(this).find("dl").children(".bundlessritem"),bundleType=$(this).parent("li").attr("data-bundle"),$mealssr=$parent.siblings("."+bundleType+".bundlessr").children();$existingMealBundle.next().not(".terms, .refundable").remove();$existingMealBundle.remove();$(this).parents("."+bundleType).find("dt.seat").after($mealssr.clone(true));if($mealssr.next().length){$(this).parents("."+bundleType).find(".bundlessritem").addClass("sub-desc")}});if($parent.siblings(".qff-voucher").find("li.qff-voucher-hidden")!=undefined){if($existing.parents(".card-inner").find("dt.qff-voucher-def").length>0){if($parent.siblings(".qff-voucher").find("div.qff-voucher-hidden").length>0){$existing.parents(".card-inner").find("dt.qff-voucher-def").replaceWith($parent.siblings(".qff-voucher").find("div.qff-voucher-hidden").html())}else{$existing.parents(".card-inner").find("dt.qff-voucher-def").hide()}}else{if($existing.parents(".card-inner").find("dt.flight-voucher-header").length>0&&$existing.parents(".card-inner").find("dd.flight-voucher-amount").length>0){outputVoucherAmounts($parent.siblings(".qff-voucher").find("div.qff-voucher-hidden dd.flight-voucher-amount"),$existing.parents(".card-inner").find("dd.flight-voucher-amount"),$parent.siblings(".qff-voucher").find("div.qff-voucher-hidden dt.flight-voucher-header"),$existing.parents(".card-inner").find("dt.flight-voucher-header"))}else{if($existing.parents(".card-inner").find("dt.flight-voucher-header-amount").length>0){outputVoucherAmounts($parent.siblings(".qff-voucher").find("div.qff-voucher-hidden dt.flight-voucher-header-amount"),$existing.parents(".card-inner").find("dt.flight-voucher-header-amount"),null,$existing.parents(".card-inner").find("dt.flight-voucher-header-amount"))}}}}if($parent.siblings(".qff-voucher").find("div.qff-voucher-hidden").length<1){$existing.parents(".card-inner").find("dd.qff-voucher-overlay").replaceWith("")}if($parent.siblings(".qff-voucher").find("div.qff-ifvoucher-hidden-dt").length>0){$existing.parents(".card-inner").find("dt.qff-ifvoucher-def").replaceWith($parent.siblings(".qff-voucher").find("div.qff-ifvoucher-hidden-dt").html());$existing.parents(".card-inner").find("dd.qff-ifvoucher-desc").replaceWith($parent.siblings(".qff-voucher").find("div.qff-ifvoucher-hidden-dd").html());$existing.parents(".card-inner").find("dd.qff-ifvoucher-overlay").show();$existing.parents(".card-inner").find("dd.qff-ifvoucher-link").show()}else{$existing.parents(".card-inner").find("dt.qff-ifvoucher-def").replaceWith('<dt class="qff-ifvoucher-def hidden"></dt>');$existing.parents(".card-inner").find("dd.qff-ifvoucher-desc").replaceWith('<dd class="qff-ifvoucher-desc hidden"></dd>');$existing.parents(".card-inner").find("dd.qff-ifvoucher-overlay").hide();$existing.parents(".card-inner").find("dd.qff-ifvoucher-link").hide()}$existing.parent("label").attr("id",fieldAttributes.id);$existing.parent("label").attr("for",fieldAttributes.id);$existing.replaceWith($clone)});function outputVoucherAmounts(parentVoucherAmount,currentVoucherAmount,parentVoucherHeader,currentVoucherHeader){if(parentVoucherAmount.length>0){if(parentVoucherHeader!=null&parentVoucherHeader!==undefined){currentVoucherAmount.replaceWith(parentVoucherAmount[0].outerHTML)}if(parentVoucherHeader!=null&parentVoucherHeader!==undefined){currentVoucherHeader.replaceWith(parentVoucherHeader[0].outerHTML)}}else{currentVoucherHeader.replaceWith('<dt class="qff-voucher-def hidden"></dt>');currentVoucherAmount.replaceWith("")}}target.parents("td").find(".bundle-price").each(function(){if(isUATLocalHost){$(".bannerPath").each(function(){if($(this).val().toLowerCase().indexOf("static.jetstar.com")>=0){var pathval=$(this).val().split("static.jetstar.com/");if(pathval.length>1){$(this).val(pathval[1])}}})}if($bundleContainer.find('input[type="checkbox"]').length>0&&$bundleContainer.find('input[type="checkbox"]').val().indexOf("GK~")>0){$bundleContainer.find(".jet-protect").show()}else{$bundleContainer.find(".jet-protect").hide()}if($(this).hasClass("starter-plus-yes")){$bundleContainer.find(".cta-bundle-starter-plus-price").text($(this).text());var plusMerchandizingIncludedValue=$bundleContainer.find(".bundle-option.starter-plus-yes").attr("plusMerchandizingIncludedValue");if(plusMerchandizingIncludedValue==0){$bundleContainer.find(".cta-bundle").addClass("hidden");$bundleContainer.find(".cta-condition").addClass("hidden").siblings(".bundle-status").addClass("mb-10")}else{$bundleContainer.find(".cta-bundle").removeClass("hidden");$bundleContainer.find(".cta-condition").removeClass("hidden").siblings(".bundle-status").removeClass("mb-10");$bundleContainer.find(".cta-bundle-starter-plus-included-value").text(plusMerchandizingIncludedValue)}bannerFileName="";if($(this).parent().parent().parent().find(".bannerFileNamePlus").length!=0){bannerFileName=$(this).parent().parent().parent().find(".bannerFileNamePlus").val()}if(bannerFileName==""){bannerFileName=$(".defaultBannerFileNamePlus").val()}$bundleContainer.find(".plus .banner").html('<img src="'+$(".bannerPath").val()+bannerFileName+'" />');if($(this).parent().parent().parent().find(".bannerLabelIdPlus").length!=0){$bundleContainer.find(".plus .bannerLabelIdPlusValue").val($(this).parent().parent().parent().find(".bannerLabelIdPlus").val())}else{$bundleContainer.find(".plus .bannerLabelIdPlusValue").val("")}}if($(this).hasClass("starter-max-yes")){bannerFileName="";if($(this).parent().parent().parent().find(".bannerFileNameMax").length!=0){bannerFileName=$(this).parent().parent().parent().find(".bannerFileNameMax").val()}if(bannerFileName==""){$bundleContainer.find(".max .banner").html("");$bundleContainer.find(".max .card-top p").css("padding-right","0")}else{$bundleContainer.find(".max .banner").html('<img src="'+$(".bannerPath").val()+bannerFileName+'" />');$bundleContainer.find(".max .card-top p").css("padding-right","60px")}if($(this).parent().parent().parent().find(".bannerLabelIdMax").length!=0){$bundleContainer.find(".plus .bannerLabelIdMaxValue").val($(this).parent().parent().parent().find(".bannerLabelIdMax").val())}else{$bundleContainer.find(".plus .bannerLabelIdMaxValue").val("")}}if($(this).hasClass("business-max-yes")){$bundleContainer.parent().find(".plus .bannerLabelIdPlusValue").val("");$bundleContainer.parent().find(".plus .bannerLabelIdMaxValue").val("")}var hasCustomLabel=false;$bundleContainer.parents("div.fare-picker").find("p.bundle_customLabel").hide();$bundleContainer.parents("div.fare-picker").find(".bannerLabelIdValue").each(function(){if($(this).val()!=""){hasCustomLabel=true;$bundleContainer.parents("div.fare-picker").find("p.bundle_"+$(this).val()).show()}});if(hasCustomLabel==true){$bundleContainer.parents("div.fare-picker").find("p.bundle_defaultLabel").hide()}else{$bundleContainer.parents("div.fare-picker").find("p.bundle_defaultLabel").show()}$bundleContainer.find('.bundle-price[class="'+$(this).attr("class")+'"]').replaceWith($(this).clone(false))});jetstarFares.bundleCardCheckboxHandler();jetstarFares.starterBaggageSelectionHandler();if(Culture=="en-US"){$(".focus .baggage-option input:radio.baggage-no").prop("checked",true).click();$(".focus .baggage-option input:radio.radio").prop("checked",false)}else{$bundleContainer.find(".baggage-option input.baggage-yes").prop("checked",true).click()}if(type=="starter"&&preselectedBundle=="PLUS"){if($(".starter-expand").length>0){$bundleContainer.find("input.starter-plus-yes").prop("checked",true)}$bundleContainer.find("input.starter-plus-yes").prop("disabled",true).parent("label.bundle-status").click();$bundleContainer.find("input.starter-plus-yes").siblings("span.remove").addClass("hidden");var $checkboxPlus=$bundleContainer.find(".bundle-cards li.plus div.bundle-status input:checkbox");if($checkboxPlus!=null){$bundleContainer.find(".bundle-cards li.plus .btn-remove").hide();$checkboxPlus.prop("checked","checked");$checkboxPlus.change()}}if(type=="starter"&&preselectedBundle=="MAX"){$bundleContainer.find("input.starter-plus-yes").parent("label.bundle-status").addClass("hidden");$bundleContainer.find("input.starter-plus-yes").prop("disabled",true);if($(".starter-expand").length>0){$bundleContainer.find("input.starter-max-yes").prop("checked",true)}$bundleContainer.find("input.starter-max-yes").siblings("span.remove").addClass("hidden");$bundleContainer.find("input.starter-max-yes").prop("disabled",true).parent("label.bundle-status").click();var $checkboxMax=$bundleContainer.find(".bundle-cards li.max div.bundle-status input:checkbox");if($checkboxMax!=null){$bundleContainer.find(".bundle-cards li.max .btn-remove").hide();$bundleContainer.find(".bundle-cards li.plus .btn-wrap").hide();$checkboxMax.prop("checked","checked");$checkboxMax.change()}}if(type=="business"&&preselectedBundle=="BUSINESS-MAX"){$bundleContainer.find("input.business-max-yes").prop("checked",true).change().prop("disabled",true);toggleButton($bundleContainer,"btn-is-selected","btn-is-default");$bundleContainer.find('div[class*="btn-is-selected"]').find("button").addClass("disabled").prop("disabled",true);if(window.Cufon!=undefined){Cufon.refresh()}}if(type=="business"){$bizBundle=$bundleContainer.find("input.business-max-yes");$bizBundle.siblings("label").attr("for",$bizBundle.attr("id")).removeAttr("id");if(Culture!="en-US"&&!isC3&&(Mode==""||$bizBundle.attr("was-selected")=="true")){toggleButton($bundleContainer,"btn-is-selected","btn-is-default");$bizBundle.not(":checked").trigger("click",["primed"])}else{if(preselectedBundle!="BUSINESS-MAX"){toggleButton($bundleContainer,"btn-is-default","btn-is-selected")}}}function toggleButton(container,btnShow,btnHide){container.find('div[class*="'+btnShow+'"]').show();container.find('div[class*="'+btnHide+'"]').hide()}},starterBaggageRequiredHandler:function(){var baggageDefault="BG20";$(".baggage-option input.baggage-no").click(function(){var $select=$(this).parents(".baggage-option").find("select");var option=document.createElement("option");$(option).attr("data-price","0.00").prop("value","0").prop("selected",true).appendTo($select);$select.trigger("change").prop("disabled",true).addClass("disabled")});$(".baggage-option input.baggage-yes").click(function(){$(this).siblings("select").find('option[value=""]').remove();$(this).siblings("select").prop("disabled",false).removeClass("disabled").val(baggageDefault).trigger("change")})},starterBaggageSelectionHandler:function(){var item="baggage";$(".focus .baggage-option select").unbind("change");$(".focus .baggage-option select").change(function(){var direction=($(this).parents(".fare-picker").hasClass("depart"))?"depart":"return";jetstarFares.updatePriceSummary($(this).find("option:selected"),item,direction)})},bundleCheckboxHandler:function(){var item="bundles";$(".fare-picker .starter-options input.checkbox").bind("click",function(e,primed){var direction=jetstarFares.getFareDirection($(this)),$label=$(this).parent().find("label"),$sibling=$(this).parents(".option").siblings(".option").find("input.checkbox");if(primed){$(this).prop("checked",true);e.preventDefault()}if($(this).prop("checked")){$sibling.prop("checked",false);$label.text(strStarterOptRemoveText);maxBundle=$(this).hasClass("starter-max-yes");friendForFreeSale=$("."+direction+" .active-flight input:radio:checked").parent(".field").siblings(".jquery-sale-f4f").length>0?true:false;if(friendForFreeSale&&maxBundle){jetstarFares.launchModal("MaxBundleSaleWarning.aspx",null,function(){},direction)}}else{$label.text(strOptAddText)}jetstarFares.updatePriceSummary($(this),item,direction);if($(this).prop("checked")==false&&$sibling.hasClass("starter-plus-yes")&&$sibling.prop("disabled")==true){$sibling.trigger("click",["primed"]).prop("disabled",true)}});$(".fare-picker .business-options input.checkbox").bind("click",function(e,primed){var direction=jetstarFares.getFareDirection($(this)),czechBox=$(this),labelChecked=strBusinessOptRemoveText,labelUnchecked=strOptAddText;if(Culture=="en-US"){labelChecked=strBusinessOptRemoveTextUS;labelUnchecked=strOptAddTextUS}if(primed){czechBox.prop("checked",true);e.preventDefault()}if(czechBox.is(":checked")&&czechBox.is(":disabled")==true){labelChecked=strBusinessOptAddedC3Text;labelUnChecked=strBusinessOptAddedC3Text}if(czechBox.is(":checked")){czechBox.parent().find("label").html(labelChecked)}else{czechBox.parent().find("label").html(labelUnchecked)}jetstarFares.updatePriceSummary(czechBox,item,direction)})},bundleCardCheckboxHandler:function(){var item="bundles";$(".fare-picker .bundle-cards label.bundle-status").unbind("click").bind("click",function(e){var $elf=$(this);$checkbox=$elf.find("input:checkbox");e.preventDefault();if($checkbox.is(":not(:disabled)")){$checkbox.prop("checked",function(){return($elf.hasClass("added"))?false:true})}$checkbox.change();if(typeof jetstarLivePerson!="undefined"){jetstarLivePerson.getCardBundleItemCheckboxToggle($checkbox)}if($checkbox.prop("checked")){maxBundle=$checkbox.hasClass("starter-max-yes");friendForFreeSale=$("."+direction+" .active-flight input:radio:checked").parent(".field").siblings(".jquery-sale-f4f").length>0?true:false;if(friendForFreeSale&&maxBundle){jetstarFares.launchModal("MaxBundleSaleWarning.aspx",null,function(){},direction)}}});$(".fare-picker .bundle-cards .bundle-status input:checkbox").unbind("change").bind("change",function(e){if($(this).hasClass("business-max-yes")){return}var $elf=$(this);siblings=$elf.closest("ol").find("input.checkbox"),preselectedBundle=$elf.closest("ol").find("input.checkbox:disabled"),direction=jetstarFares.getFareDirection($elf),isC3=($("div.C3").length>0)?true:false;e.preventDefault();if($elf.is(":disabled")){starterOrBusiness=$elf.parents("tr").hasClass("starter-options")?".starter":".business";if(isC3==true){marketIndex=$elf.attr("market-index");selectedFareType=$(starterOrBusiness+" input[type=radio][market-index="+marketIndex+"]:checked")}else{selectedFareType=$(starterOrBusiness+" input[type=radio]:checked")}if(selectedFareType.length>0){$elf.prop("checked",true)}}if($elf.is(":checked")){$elf.parent("label").addClass("added");checkSiblings(siblings);if($(".change-flight-select").length>0){jetstarBook.manageBooking.Datalayer.selectBundle(this)}}else{$elf.parent("label").removeClass("added")}jetstarFares.updatePriceSummary($elf,item,direction);if($elf.prop("checked")==false&&$elf.is(":not(:disabled)")&&siblings.hasClass("starter-plus-yes")&&siblings.prop("disabled")){preselectedBundle.trigger("change",["primed"]).prop("disabled",true)}function checkSiblings(inputs){inputs.each(function(i,o){o=$(o);if(o.attr("class")!=$elf.attr("class")){o.parent().removeClass("added");o.prop("checked",false)}})}});$(".fare-picker .business-options input.checkbox").unbind("click").bind("click",function(e,primed){var direction=jetstarFares.getFareDirection($(this)),czechBox=$(this),labelChecked=strBusinessOptRemoveText,labelUnchecked=strOptAddText;if(Culture=="en-US"){labelChecked=strBusinessOptRemoveTextUS;labelUnchecked=strOptAddTextUS}if(primed){czechBox.prop("checked",true);e.preventDefault()}if(czechBox.is(":checked")&&czechBox.is(":disabled")==true){labelChecked=strBusinessOptAddedC3Text;labelUnChecked=strBusinessOptAddedC3Text}if(czechBox.is(":checked")){czechBox.parent().find("label").html(labelChecked)}else{czechBox.parent().find("label").html(labelUnchecked)}jetstarFares.updatePriceSummary(czechBox,item,direction)});$(".fare-picker .business-options input.checkbox").unbind("change").bind("change",function(e){var direction=jetstarFares.getFareDirection($(this)),czechBox=$(this),labelChecked=strBusinessOptRemoveText,labelUnchecked=strOptAddText;if(Culture=="en-US"){labelChecked=strBusinessOptRemoveTextUS;labelUnchecked=strOptAddTextUS}if(czechBox.is(":checked")&&czechBox.is(":disabled")==true){labelChecked=strBusinessOptAddedC3Text;labelUnChecked=strBusinessOptAddedC3Text}if(czechBox.is(":checked")){czechBox.parent().find("label").html(labelChecked)}else{czechBox.parent().find("label").html(labelUnchecked)}jetstarFares.updatePriceSummary(czechBox,item,direction)})},starterOptBundleSelectHandler:function(){$(".fare-picker .starter-options .option .bundle-top").mouseenter(function(){$(this).addClass("hover")}).mouseleave(function(){var $me=$(this);if($me.hasClass("hover")){$me.removeClass("hover")}}).click(function(e){var $me=$(this),$checkbox=$me.parents(".option").find("input.checkbox");if($checkbox.prop("disabled")==true){return}$checkbox.prop("checked",function(){return !this.checked});if($checkbox.is(":checked")){$checkbox.prop("checked",true).click().prop("checked",true)}else{$checkbox.prop("checked",false).click().prop("checked",false)}checkBoxAction($checkbox)});$(".fare-picker .starter-options .option .bundle-detail .field").click(function(e){var $checkbox=$(this).find("input.checkbox");if($checkbox.prop("disabled")==true){return}if(e.target.type!=="checkbox"){$checkbox.prop("checked",function(){return !this.checked});if($checkbox.is(":checked")){$checkbox.prop("checked",true).click().prop("checked",true)}else{$checkbox.prop("checked",false).click().prop("checked",false)}$(this).parent().siblings(".bundle-top").toggleClass("selected")}checkBoxAction($checkbox);$(this).parent().siblings(".bundle-top").toggleClass("selected")});$(".fare-picker .starter-options input.max-checkbox").change(function(){if($(this).is(":checked")){jetstarFares.launchModal("maxbundle-modal-content.shtml",null,function(){})}});$(".fare-picker .starter-options .option .bundle-detail input:checked").parent().parent().siblings(".bundle-top").addClass("selected");function checkBoxAction(checkBox){if(checkBox.is(":checked")){checkBox.parent().find("label").text(strStarterOptRemoveText);checkBox.parents(".option").siblings(".option").find("input:checkbox").prop("checked",false).parent().parent().siblings(".bundle-top").removeClass("selected");checkBox.parents(".option").siblings(".option").find("label").text(strOptAddText)}else{checkBox.parent().find("label").text(strOptAddText);if(checkBox.parents(".option").siblings(".option").find("input:checkbox").is(":disabled")==true&&checkBox.parents(".option").siblings(".option").find("input:checkbox").is(":checked")==false){checkBox.parents(".option").siblings(".option").find("input:checkbox").prop("checked",true).parent().parent().siblings(".bundle-top").addClass("selected");checkBox.parents(".option").siblings(".option").find("label").text(strStarterOptRemoveText)}}}},getFareDirection:function(trigger){return $(trigger).parents(".fare-picker").hasClass("depart")?"depart":"return"},upgradeButtonHandler:function(){$(".starter-expand .promo a.button, .starter-options .promo a.button").click(function(e){e.preventDefault();$(this).parents(".starter-options").prev("tr").find(".business input:radio").trigger("click",["primed"])})},businessOptBundleSelectHandler:function(){$(".fare-picker .business-options .option .bundle-top").mouseenter(function(){$(this).addClass("hover")}).mouseleave(function(){var $me=$(this);if($me.hasClass("hover")){$me.removeClass("hover")}}).click(function(e){var $me=$(this),$checkbox=$me.siblings(".bundle-detail").find("input.checkbox");if($checkbox.prop("disabled")==true){return}$checkbox.prop("checked",function(){return !this.checked});if($checkbox.is(":checked")){$checkbox.prop("checked",true).click().prop("checked",true)}else{$checkbox.prop("checked",false).click().prop("checked",false)}checkBoxAction($checkbox)});$(".fare-picker .business-options .jq-btn button").click(function(e){var $me=$(this),$checkbox=$me.parent().siblings('[class*="business-max-yes"]'),toggleAdd="btn-is-selected",toggleRemove="btn-is-default";if($me.prop("disabled")==true){return}if($me.parent('[class*="'+toggleAdd+'"]').length>0){$me.parent().siblings('[class*="'+toggleRemove+'"]').show();$checkbox.prop("checked",false).change().prop("checked",false)}else{$me.parent().siblings('[class*="'+toggleAdd+'"]').show();$checkbox.prop("checked",true).change().prop("checked",true)}$me.parent().hide()});$(".fare-picker .business-options button.jq-btn").click(function(e){var $me=$(this),$checkbox=$me.siblings('[class*="business-max-yes"]');if($me.prop("disabled")==true){return}$checkbox.prop("checked",true).click().prop("checked",true);$me.hide();$me.siblings("div.btn-is-selected").show()});$(".fare-picker .business-options .option .bundle-detail .field .business-label").click(function(e){if($.browser.msie){var $me=$(this),$checkbox=$me.parent().find("input.checkbox");if($checkbox.prop("disabled")==true){return}$checkbox.prop("checked",function(){return !this.checked});if($checkbox.is(":checked")){$checkbox.prop("checked",true).click().prop("checked",true)}else{$checkbox.prop("checked",false).click().prop("checked",false)}checkBoxAction($checkbox)}});$(".fare-picker .business-options .option .bundle-detail .field").click(function(e){var $checkbox=$(this).find("input.checkbox");checkBoxAction($checkbox);$(this).siblings(".bundle-top").toggleClass("selected")});$(".fare-picker .business-options .option .bundle-detail input:checked").parent().parent().siblings(".bundle-top").addClass("selected");$('.fare-option .business-options .bundle-option:checkbox[maxunchecked="true"]').each(function(){$(this).siblings("div.jq-btn").find("button.bus-max-remove").trigger("click")});function checkBoxAction(checkBox){if(checkBox.is(":checked")){checkBox.parent().find("label").html(strBusinessOptRemoveText)}else{checkBox.parent().find("label").html(strOptAddText)}}},moveSummaryBubble:function(target){var $activeFlight=target.find(".active-flight"),activePosition=$activeFlight.position(),activePositionTop=($activeFlight.length==0?30:activePosition.top),$hotels=$(".fare-option .hotel-listing");if($hotels.length>0&&$activeFlight.length==0){activePosition=target.find("tr").position();activePositionTop=activePosition.top;$(".summary").css({marginTop:activePositionTop})}else{$(".summary").css({marginTop:activePositionTop-30})}},flightInWindow:function(){if($(".fare-picker .summary .bubble").length<=0){return false}var target,docViewTop,docViewBottom,departingHeight,departingTop,departingBottom,departingVisible,returningHeight,returningTop,returningBottom,returningVisible,hotelsHeight,hotelsTop,hotelsBottom,hotelsVisible=0,$target=$("#booking-summary"),$bubble=$(".fare-option .summary .bubble"),$cta=$(".fare-option .summary .cta"),$depart=$(".fare-option .depart"),$return=$(".fare-option .return"),$hotels=$(".fare-option .hotel-listing"),origTarget="",windowHeight=$(window).height(),bHotels=false;if($target.find(".departing").hasClass("oneway")){return false}if($hotels.length>0){bHotels=true}$(window).scroll(function(){docViewTop=$(window).scrollTop();docViewBottom=docViewTop+windowHeight;departingHeight=$depart.height();departingTop=$depart.offset().top;departingBottom=departingTop+departingHeight;departingVisible=departingHeight-(departingTop<docViewTop?docViewTop-departingTop:0)-(docViewBottom<departingBottom?departingBottom-docViewBottom:0);returningHeight=$return.height();returningTop=$return.offset().top;returningBottom=returningTop+returningHeight;returningVisible=returningHeight-(returningTop<docViewTop?docViewTop-returningTop:0)-(docViewBottom<returningBottom?returningBottom-docViewBottom:0);if(bHotels){hotelsHeight=$hotels.height();hotelsTop=$hotels.offset().top;hotelsBottom=hotelsTop+hotelsHeight;hotelsVisible=hotelsHeight-(hotelsTop<docViewTop?docViewTop-hotelsTop:0)-(docViewBottom<hotelsBottom?hotelsBottom-docViewBottom:0)}if(returningVisible>departingVisible){target="return"}if(departingVisible>returningVisible){if(departingVisible>hotelsVisible){target="depart"}if(hotelsVisible>departingVisible){target="hotel-listing"}}if(target!=origTarget){var t=$("."+target);if(t.find(".summary .bubble").length==0){$bubble.detach().appendTo(t.find(".summary"));$cta.detach().appendTo(t.find(".summary"));jetstarFares.moveSummaryBubble($("table",t));if(t.hasClass("depart")&&t.find("tr").hasClass("active-flight")){$(".summary .departing table").removeClass("closed").addClass("open");$(".summary .returning table").removeClass("open").addClass("closed");$(".summary .holidays table").removeClass("open").addClass("closed")}else{if(t.hasClass("return")&&t.find("tr").hasClass("active-flight")){$(".summary .returning table").removeClass("closed").addClass("open");$(".summary .departing table").removeClass("open").addClass("closed");$(".summary .holidays table").removeClass("open").addClass("closed")}else{if(t.hasClass("hotel-listing")){$(".summary .returning table").removeClass("open").addClass("closed");$(".summary .departing table").removeClass("open").addClass("closed");$(".summary .holidays table").removeClass("closed").addClass("open")}else{$(".summary .departing table").removeClass("open").addClass("closed");$(".summary .returning table").removeClass("open").addClass("closed");$(".summary .holidays table").removeClass("open").addClass("closed")}}}}origTarget=target}});$(window).scroll()},checkSufficientInfantAvailability:function(){var $target=$("#booking-summary"),errorMessage;infantsAvailable=function(direction){if($target.find("."+direction+" .price:visible").length==0){return true}return($target.find("."+direction+" .price").attr("data-inf-available")=="false")?false:true};if(!infantsAvailable("departing")){errorMessage=strErrFaresDepart+": "+strErrInvalidInfants}if(!infantsAvailable("returning")){errorMessage=strErrFaresReturn+": "+strErrInvalidInfants}if(errorMessage&&!$(".btn-continue").hasClass("disabled")){$(".btn-continue").addClass("disabled")}return errorMessage},bookingErrors:function(){var errorMessage,errorDate,errorLarge,isInfantSufficient,minMinutes=180,$target=$("#booking-summary"),isC3=($("div.C3").length>0)?true:false,oneway=($target.find(".departing",".returning").hasClass("oneway"))?true:false,openjaw=$("#marketstructure").val()=="OpenJaw";retainedDepartureMarket=$("#retainedDepartureMarket").val();retainedReturnMarket=$("#retainedReturnMarket").val();checkErrors=function(){errorMessage="";errorDate=false;kidsflyfreedisclaimer=($(".kids-fly-free-disclaimer").hasClass("kids-fly-free-disclaimer-check-recuired")&&!$("#kffdisclaimer").is(":checked"));if(kidsflyfreedisclaimer){errorMessage=strErrKidsFlyFreeDisclaimer;errorDate=true}if(oneway&&!fareSelected("depart")){errorMessage=strErrFaresDepartOneway}if(isC3){if(openjaw&&!oneway){if(!fareSelected("depart")&&!fareSelected("return")&&retainedDepartureMarket=="false"&&retainedReturnMarket=="false"){errorMessage=strErrFaresDepartAndReturnOpenJaw}else{if(!fareSelected("depart")&&retainedDepartureMarket=="false"&&retainedReturnMarket=="true"){errorMessage=strErrFaresDepartOpenJaw}else{if(!fareSelected("return")&&retainedReturnMarket=="false"&&retainedDepartureMarket=="true"){errorMessage=strErrFaresReturnOpenJaw}}}}if(!oneway&&!openjaw&&!fareSelected("depart")&&retainedDepartureMarket=="false"&&retainedReturnMarket=="true"){errorMessage=strErrFaresDepart}if(!oneway&&!openjaw&&!fareSelected("return")&&retainedReturnMarket=="false"&&retainedDepartureMarket=="true"){errorMessage=strErrFaresReturn}if(!oneway&&!openjaw&&!fareSelected("depart")&&!fareSelected("return")&&retainedDepartureMarket=="false"&&retainedReturnMarket=="false"){errorMessage=strErrFaresDepartAndReturn}}else{if(openjaw&&!oneway){if(!fareSelected("depart")&&!fareSelected("return")){errorMessage=strErrFaresDepartAndReturnOpenJaw}else{if(!fareSelected("depart")){errorMessage=strErrFaresDepartOpenJaw}else{if(!fareSelected("return")&&retainedReturnMarket=="false"){errorMessage=strErrFaresReturnOpenJaw}}}}if(!oneway&&!openjaw&&!fareSelected("depart")){errorMessage=strErrFaresDepart}if(!oneway&&!openjaw&&!fareSelected("return")){errorMessage=strErrFaresReturn}if(!oneway&&!openjaw&&!fareSelected("depart")&&!fareSelected("return")){errorMessage=strErrFaresDepartAndReturn}}var errorMessageInfant=jetstarFares.checkSufficientInfantAvailability();isInfantSufficient=!errorMessageInfant;var errorMessageInfant=jetstarFares.checkSufficientInfantAvailability();isInfantSufficient=!errorMessageInfant;if(errorMessage==null||errorMessage==""){if($("#marketstructure").val()=="OpenJaw"&&!isC3){var flight1ArrivalDate=Date.parse($("#booking-summary").find(".departing .date-time").last().attr("data-date-arrv"));var flight2DepartureDate=Date.parse($("#booking-summary").find(".returning .date-time").last().attr("data-date-dept"));var hourDiff=flight2DepartureDate-flight1ArrivalDate;hourDiff=Math.abs(hourDiff);if(Math.floor(hourDiff/1000/60)<(26*60)){errorDate=true;errorMessage=strErrDepartLessThan26}}else{if(!flightTimesValid("time")){errorDate=true;errorMessage=strErrInvalidTimes}}if(!flightTimesValid("date")){errorDate=true;errorMessage=strErrInvalidDates}if(!luggageOptionValid("depart")){errorLarge=true;errorMessage=strErrFaresDepart}if(!oneway&&!luggageOptionValid("return")){errorLarge=true;errorMessage=strErrFaresReturn}if(!oneway&&!luggageOptionValid("depart")&&!luggageOptionValid("return")){errorLarge=true;errorMessage=strErrFaresDepartAndReturn}if(!isInfantSufficient){errorMessage=errorMessageInfant;errorDate=!isInfantSufficient}if(!sufficientPoints()){errorDate=true;errorMessage=strErrInsufficientPoints}if($("input[name*='summary-user-acknowledge-checkbox']").length>0&&!$(".important-info-box").hasClass("hide")){$("input[name*='summary-user-acknowledge-checkbox']").each(function(){if(!$(this).is(":checked")){errorDate=true;errorMessage=$(this).attr("data-error-message")}})}}if(!errorMessage&&isInfantSufficient){$(".btn-continue").removeClass("disabled");$(".important-info-modal").removeClass("overlay-disabled")}else{if(!$(".btn-continue").hasClass("disabled")){$(".btn-continue").addClass("disabled");$(".important-info-modal").addClass("overlay-disabled")}}jetstarFares.togglePriceLock();jetstarFares.importantInfoPopup()};fareSelected=function(direction){return($(".fare-option ."+direction+" .active-flight input.radio:checked").length>0)?true:false};flightTimesValid=function(measure){var arrivalDate=Date.parse($target.find(".departing .date-time").last().attr("data-date-arrv")),returningDate=Date.parse($target.find(".returning .date-time").first().attr("data-date-dept"));if(measure=="time"){if(arrivalDate!=null&&returningDate!=null){return(arrivalDate.addMinutes(minMinutes).compareTo(returningDate)==1)?false:true}else{return true}}if(measure=="date"){if(arrivalDate!=null&&returningDate!=null){return(arrivalDate.compareTo(returningDate)==1)?false:true}else{return true}}};luggageOptionValid=function(direction){if($(".fare-option ."+direction+" .active-flight input.radio:checked").parents("td").hasClass("starter")&&($(".fare-option ."+direction+" .baggage-option").length>0&&$(".fare-option ."+direction+" .baggage-option input.radio:checked").length<1)){return false}else{return true}};infantsAvailable=function(direction){return($target.find("."+direction+" .price").attr("data-inf-available")=="false")?false:true};sufficientPoints=function(direction){var currencyCode=$target.find(".total-price .price").attr("data-currency"),pointsBalance=$target.find(".total-price .price").attr("data-point-balance"),pointsMinimum=$target.find(".total-price .price").attr("data-point-minimum");return(currencyCode=="Points"&&(parseFloat(pointsBalance)<parseFloat(pointsMinimum)))?false:true};writeSpinner=function(obj){setTimeout(function(){obj.addClass("in-progress");if(window.Cufon!=undefined){Cufon.refresh(".jq-btn")}},100)};$(".change-flight .btn-continue, .fares .btn-continue").mouseenter(function(){checkErrors();if(errorMessage){if(errorDate==true){$target.prepend('<div class="error-message"><span class="alert"></span><p>'+errorMessage+"</p></div>")}else{if(errorLarge==true){$target.prepend('<div class="error-message error-message-big"><span class="alert"></span><p>'+strErrFaresBaggageStart+"<strong>"+errorMessage+"</strong>"+strErrFaresBaggageEnd+"</p></div>")}else{$target.prepend('<div class="error-message"><span class="alert"></span><p>'+strErrFaresGenericStart+" <strong>"+errorMessage+"</strong> "+strErrFaresGenericEnd+"</p></div>")}}}});$(".change-flight .btn-continue, .fares .btn-continue").mouseleave(function(){errorMessage="";errorDate=false;isInfantSufficient=false;$target.find(".error-message").remove()});$(".change-flight .btn-continue, .fares .btn-continue:not(.important-info-update), #baggage-info-update .btn-continue:not(.in-progress)").live("click",function(e){var obj=$(this);if(!obj.hasClass("disabled")){e.preventDefault();if(userType!="MASTERAGENT"&&userType!="AGENT"){var priceDataElem=$("#buttonWrapper .price");if(priceDataElem!=null){if(priceDataElem.attr("data-currency").toUpperCase()=="IDR"&&parseFloat(priceDataElem.attr("data-price").replace(",","."))>=21000000){$(".ird-hidden-trigger").trigger("click");return}}}$(".fare-picker .bundle-cards label.bundle-status").unbind("click");$("input:checkbox:disabled").prop("disabled",false);__doPostBack(submitButtonName,"");writeSpinner(obj)}});$("#baggage-info-update .btn-continue").live("click",function(){var obj=$(this);writeSpinner(obj);obj.find(".spinner").html('<img src="images/button-spinner-orange.gif" />')});$("input[name*='summary-user-acknowledge-checkbox']").click(function(){errorMessage="";errorDate=false;checkErrors()})},bookingSummaryTerms:function(){var UACChecked=true;if($("input[name*='summary-user-acknowledge-checkbox']").length>0){$("input[name*='summary-user-acknowledge-checkbox']").each(function(){if(!$(this).is(":checked")){UACChecked=false}});if(UACChecked){return 1}return -1}return 0},modalHandler:function(){if($("#overlay").length>0){var defaultModalWidth=$("#overlay").css("width");var defaultContentWidth=$("#overlay .content-wrap").css("width");var theframe=$('<iframe frameborder="0" scrolling="no"></iframe>');$(".launch-modal").overlay({mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"2%",onBeforeLoad:function(){if(this.getTrigger().hasClass("overlay-disabled")){return false}var wrap=this.getOverlay().find(".content-wrap"),$trigger=this.getTrigger();this.getOverlay().find(".content-wrap").html('<img src="images/elements/loader.gif" alt="loading" class="loader" />');var dynModalWidth=$trigger.attr("data-modal-width"),dynModalHeight=$trigger.attr("data-modal-height"),dynModalHeader=$trigger.attr("data-modal-header"),dynModalTitle=Boolean($trigger.attr("data-modal-title")),dynModalTitleOverride=$trigger.attr("data-modal-title-override"),dynModalCloseOverride=$trigger.attr("data-modal-close-override"),dynModalIframe=Boolean($trigger.attr("data-modal-iframe")),dynModalLocal=$trigger.attr("data-local"),dynModalIFramePadding=$trigger.attr("data-modal-iframe-padding");if(dynModalWidth!=undefined){$("#overlay").css({width:dynModalWidth+"px"});if(dynModalIframe){var pad="25px 0";if(dynModalIFramePadding!=undefined){pad=dynModalIFramePadding}$("#overlay .content-wrap").attr("style","").css({width:(dynModalWidth)+"px",padding:pad,"overflow-x":"auto","max-height":"1000px",height:"460px"})}else{$("#overlay .content-wrap").attr("style","").css({width:(dynModalWidth-12)+"px",padding:"25px 6px 6px 6px",height:"460px"});if(dynModalHeight!=undefined){$("#overlay .content-wrap").css({overflow:"hidden",height:dynModalHeight+"px"})}}}else{$("#overlay").css({width:defaultModalWidth});$("#overlay .content-wrap").attr("style","").css({width:defaultContentWidth})}dataRecieved=function(obj){$data=$(obj);wrap.html($data.html());if(dynModalHeader!=undefined){if(dynModalHeader=="false"){$("#overlay a.close.top").hide()}else{if(dynModalTitle==true&&dynModalTitleOverride!==undefined){$("#overlay h1.top").remove();headerTitle='<h1 class="top">'+dynModalTitleOverride+"</h1>";$("#overlay").prepend(headerTitle)}else{if(dynModalTitle==true&&dynModalTitleOverride==undefined){$("#overlay h1.top").remove();headerTitle=wrap.find("h1").eq(0).detach();headerTitle.addClass("top").insertBefore("a.top")}}$("#overlay a.close.top").show()}}else{$("#overlay a.close.top").hide()}if(window.Cufon!=undefined){Cufon.refresh()}$("#overlay a.close-me, #overlay a.return").click(function(e){$(".launch-modal").each(function(){$(this).overlay().close();e.preventDefault()})})};if(dynModalLocal!=undefined){dataRecieved(dynModalLocal)}else{$.get(this.getTrigger().attr("href"),function(data){var dataObj=$(data);if(dynModalIframe){var iFrameWidth=dynModalWidth-20;$(theframe).attr({src:$trigger.attr("href"),style:"height:"+dynModalHeight+"px; width:"+iFrameWidth+"px; border:none;"});wrap.html(theframe)}else{dataRecieved(dataObj.find(".go-modal"))}if(dynModalHeader!=undefined){if(dynModalHeader=="false"){$("#overlay a.close.top").hide()}else{if(dynModalTitle==true&&dynModalTitleOverride!==undefined){$("#overlay h1.top").remove();headerTitle='<h1 class="top">'+dynModalTitleOverride+"</h1>";$("#overlay").prepend(headerTitle)}else{if(dynModalTitle==true&&dynModalTitleOverride==undefined){$("#overlay h1.top").remove();headerTitle=wrap.find("h1").eq(0).detach();headerTitle.addClass("top").insertBefore("a.top")}}$("#overlay a.close.top").show()}}else{$("#overlay a.close.top").show()}if(dynModalCloseOverride!=undefined){$("#overlay a.close").html(dynModalCloseOverride)}$("#overlay a.close-me, #overlay a.return").click(function(e){$(".launch-modal").each(function(){$(this).overlay().close();e.preventDefault()})})})}},onLoad:function(){if(window.Cufon!=undefined){Cufon.refresh()}},onClose:function(){var isIE6=($("html").hasClass("ie6")?true:false);var isIE7=($("html").hasClass("ie7")?true:false);if(isIE6||isIE7){}else{this.getOverlay().find(".content-wrap").html('<img src="images/elements/loader.gif" alt="loading" class="loader" />')}}});$("#overlay .close").click(function(e){e.preventDefault()});if($("#usRedirect").length){$("#usRedirect").trigger("click")}}},launchModal:function(url,callbackFn,callbackCloseFn,direction){var overlay=$("#overlay").overlay({mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"25%",onLoad:function(){var wrap=this.getOverlay().find(".content-wrap");var overlay=this;$.get(url,function(data){var dataObj=$(data);wrap.html(dataObj.find(".go-modal").html());if(typeof callbackFn=="function"){callbackFn.call(this,data)}$("#overlay a.return").click(function(e){$("#overlay").each(function(){$(this).overlay().close();e.preventDefault()})});$("#overlay .max-cancel, #overlay .close").click(function(){$("."+direction+" .starter-max-yes").prop("checked",false).click().prop("checked",false)})});$(".ie6 .field select").hide();$("#overlay .close").click(function(e){e.preventDefault();overlay.close()})},onClose:function(){this.getOverlay().find(".content-wrap").html("");$(".ie6 .field select").show();if(typeof callbackCloseFn=="function"){callbackCloseFn.call(this)}},load:true,oneInstance:false}).load()},setCarrier:function(){if(typeof(dominantCarrier)!="undefined"){var userTypes=new Array();userTypes.AGENT="Agent";userTypes.MASTERAGENT="Agent";userTypes.MEMBER="Member";if(dominantCarrier=="BL"){$("#book-header .topbar img").attr("src",logo[dominantCarrier]);$("#book-header .topbar img").removeAttr("height").removeAttr("width")}if(dominantCarrier=="BL"||dominantCarrier=="3K"){if(typeof(userTypes[userType])!="undefined"){$("#SkySales").attr("action",action+"?skin=Go"+dominantCarrier+userTypes[userType])}}}},validateImportantInfo:function(){var $target=$("#booking-summary"),oneway=($target.find(".departing",".returning").hasClass("oneway"))?true:false;var $departFlight=$(".fare-option").find(".depart .active-flight");var $returnFlight=$(".fare-option").find(".return .active-flight");var showUAC=0;var domIntTerm="";$(".fare-option").find("tr input.radio:checked").each(function(){domIntTerm=$(this).attr("domestic-international-terminal");if(domIntTerm!=null&&domIntTerm.length>0){return false}});if($(".important-airport-info").length>0){showUAC=1}if(domIntTerm!=null&&domIntTerm.length>0){$(".dom_int_display").show();showUAC=1}else{$(".dom_int_display").hide()}if(!oneway){var deptStation=$departFlight.find("a.airport span").text();if(deptStation.length<=0){deptStation=$departFlight.find("a.airport:first").text()}var returnStation=$returnFlight.find("a.airport span").text();if(returnStation.length<=0){returnStation=$returnFlight.find("a.airport:last").text()}if(deptStation.length>0&&returnStation.length>0&&deptStation.toLowerCase()!=returnStation.toLowerCase()){$(".diff_ret_flight_display").show();showUAC=1}else{$(".diff_ret_flight_display").hide()}}else{$(".diff_ret_flight_display").hide()}if($(".sos_3k_display").length>0){var numberOfStops=$departFlight.find(".stops").attr("number-of-stops");if(numberOfStops>0){$(".sos_3k_display").show();showUAC=1}else{$(".sos_3k_display").hide()}}var result=0;$(".gk_bg_display").hide();$(".fare-option").find(".active-flight").each(function(){if(result!=2){result=hasGkFlights($(this).find(".field input[type=radio]").val())}if(result>0){$(".gk_bg_display").show();$(".gk_bg_display").attr("style","border-top:0px");showUAC=1}if(result>1){$(".gk_bg_display .overnight-info").show()}else{$(".gk_bg_display .overnight-info").hide()}});if(showUAC>0){$(".important-info-box").show();$(".important-info-box").removeClass("hide")}else{$(".important-info-box").hide();$(".important-info-box").addClass("hide")}function hasGkFlights(route){if(route==null){return 0}var routeArray=route.split(" ");var datesArray=[],marketsArray=[];for(var i=0;i<routeArray.length;i++){if(routeArray[i]!=""){var tempArray=routeArray[i].split("~");for(var j=0;j<tempArray.length;j++){if(j==0&&tempArray[j]=="0"){return 0}if(tempArray[j]!=undefined&&tempArray[j].length>0){if(tempArray[j].match("^[A-Z]{3,3}$")){marketsArray.push(tempArray[j])}else{if(tempArray[j].match(/^(?:([0-9]{2})[\/.]([0-9]{2})[\/.][0-9]{4})$/)){datesArray.push(tempArray[j])}}}}}}var isGk=false;if(marketsArray.length==0||marketsArray.length!=datesArray.length){return 0}if(route.match(/\bGK\b/)){isGk=true}if(isGk){for(i=0;i<marketsArray.length-1;i++){var next=i+1;if(marketsArray[i]==marketsArray[next]){if(datesArray[i]!=datesArray[next]){return 2}}}return 1}return 0}},initPriceLock:function(){$("#pricelock-agree").prop("checked",false).closest(".pricelock-activate").hide();$(".activatePriceLock").click(function(e){e.preventDefault();$(this).hide();(isIE||isIE6)?$(".pricelock-activate").show():$(".pricelock-activate").slideDown("fast")});$(".pricelock-cancel").click(function(e){e.preventDefault();$(this).closest(".pricelock-activate").hide().closest(".price-lock").find(".activatePriceLock").show();$("#pricelock-agree").prop("checked",false);$(".pricelock-continue .error-message").hide()});$("#pricelock-agree").change(function(){$(".pricelock-continue .error-message").hide()});if($("#price-lock-continue-button").parent(".btn-wrap").length>0){$("#price-lock-continue-button").parent(".btn-wrap").click(function(e){e.preventDefault();$(".pricelock-continue .error-message").hide();$("#pricelock-agree").prop("checked",true);$(".btn-continue").click();writeSpinner($(this));return})}else{$("#price-lock-continue-button").click(function(e){e.preventDefault();$(".pricelock-continue .error-message").hide();$("#pricelock-agree").prop("checked",true);$(".btn-continue").click();return})}},togglePriceLock:function(){var oneway=false;if($(".oneway").length>0){oneway=true}departingFare=$(".fare-option .depart .starter, .fare-option .depart .business").find("input:radio:checked");returningFare=$(".fare-option .return .starter, .fare-option .return .business").find("input:radio:checked");if(departingFare.length>0&&returningFare.length>0||departingFare.length>0&&oneway||returningFare.length>0&&oneway){if($(".important-info-box").length==0||$(".important-info-box").hasClass("hide")||$("#summary-user-acknowledge-checkbox:checked").length>0){var dpl=departingFare.attr("price-lock-available");var rpl=returningFare.attr("price-lock-available");if(dpl=="True"&&rpl=="True"||dpl=="True"&&oneway||rpl=="True"&&oneway){togglePriceLockDisplay(true);var departurePriceLockCharge=departingFare.attr("journey-price-lock-amount");if(isNaN(departurePriceLockCharge)){departurePriceLockCharge=0}var returnPriceLockCharge=returningFare.attr("journey-price-lock-amount");if(isNaN(returnPriceLockCharge)){returnPriceLockCharge=0}var priceLockCharge=Number(departurePriceLockCharge)+Number(returnPriceLockCharge);$(".price-lock-charge").text(priceLockCharge)}else{togglePriceLockDisplay(false)}}else{togglePriceLockDisplay(false)}}},importantInfoPopup:function(){var result=false,fullDate="",shortStarDate="",shortEndDate="",lastRdo=null,hideOldInfo=false,fareRadioBtns=[],rdoBtnCount=0;$(".fare-option .depart .active-flight input.radio:checked, .fare-option .return .active-flight input.radio:checked").each(function(){fareRadioBtns.push($(this))});rdoBtnCount=fareRadioBtns.length;if(rdoBtnCount===2){if($(fareRadioBtns[0]).attr("data-show-popup")!==$(fareRadioBtns[1]).attr("data-show-popup")&&$(fareRadioBtns[1]).attr("data-show-popup")==="True"){result=true}}$(fareRadioBtns).each(function(){hideOldInfo=hideOldInfo||$(this).attr("data-hide-old-bg")==="True"});if(result){$(".page-default-continue").hide();$(".important-info-update").show()}else{$(".page-default-continue").show();$(".important-info-update").hide()}if(hideOldInfo){$(".hideOldCOBInfo").hide()}lastRdo=$(fareRadioBtns[rdoBtnCount-1]).eq(0);fullDate=lastRdo.attr("data-popup-bg-date");shortStarDate=lastRdo.attr("data-popup-bg-first-date");shortEndDate=lastRdo.attr("data-popup-bg-last-date");var infoPopup=$("#baggage-info-update-modal");infoPopup.find(".active-date").html(fullDate);infoPopup.find(".baggage-limits .to").html(shortStarDate);infoPopup.find(".baggage-limits .from").html(shortEndDate)},initToggleFeeTaxBreakdown:function(){$(".departing .fee-and-tax").click(function(e){e.preventDefault();$(".departing-adt-fee").toggle();$(".departing .fee-and-tax .png-bg").toggleClass("uparrow");$(".departing-chd-fee").toggle();toggleFeePaxHeadBold($(this))});$(".returning .fee-and-tax").click(function(e){e.preventDefault();$(".returning-adt-fee").toggle();$(".returning .fee-and-tax .png-bg").toggleClass("uparrow");$(".returning-chd-fee").toggle();toggleFeePaxHeadBold($(this))});function toggleFeePaxHeadBold(obj){var adultHead=obj.parent().siblings(".fees-adult").find("th");var childHead=obj.parent().siblings(".fees-child").find("th");var infantHead=obj.parent().siblings(".fees-infant").find("th");if(adultHead.hasClass("title")){adultHead.removeClass("title");childHead.removeClass("title");infantHead.removeClass("title")}else{adultHead.addClass("title");childHead.addClass("title");infantHead.addClass("title")}}},populateModalHeader:function(){$(".launch-modal").click(function(){$("h1#modal-header").text($(".fill-modal-header").eq(0).text())})},initCTARevampBundleAdd:function(){$("div.btn-wrap.bundle-status input:radio").each(function(){var $this=$(this),$checkbox=$this.siblings("input:checkbox");if(this.checked!=$checkbox.is(":checked")){this.checked=$checkbox.is(":checked");$this.change()}});$("div.btn-wrap.bundle-status input:radio").bind("change",function(){var $this=$(this),$checkbox=$this.siblings("input:checkbox");if(this.checked!=$checkbox.is(":checked")){$checkbox.prop("checked",this.checked);$checkbox.change()}})}}})();priceLockFlag=(function(){return{Init:function(){$("#pricelock-agree").prop("checked",false).closest(".pricelock-activate").hide()},SetState:function(boolVal){$("#pricelock-agree").prop("checked",boolVal)}}})();priceLockControlV2=(function(){var me=this;return{Init:function(){$("#btnSubmit .pricelock-continue").click(function(e){$(this).parent(".btn-wrap").addClass("in-progress");$(document).trigger("PriceLock.OnSubmit")})},Hide:function(){$(".price-lockV2").hide();$(".hold-fares").hide();$(".price-lock-body").css({"background-image":"","background-color":"white"})},Show:function(){$(".price-lock-body").css({background:"#f6f6f6 url(../images/bg-price-lock.png) 100% 0 repeat-y"});$(".price-lockV2").show();$(".hold-fares").show()}}})();priceLockHandler=(function(){var plControl,flightOptionsControl;function onFlightSelected(){}function onPriceLockSubmit(){priceLockFlag.SetState(true);flightOptionsControl.Submit()}function bindEvents(){$(document).on("FlightOptions.OnFlightSelected",onFlightSelected);$(document).on("PriceLock.OnSubmit",onPriceLockSubmit)}return{Init:function(plCtrl,flightOptionsCtrl){plControl=plCtrl;flightOptionsControl=flightOptionsCtrl;plControl.Hide();bindEvents();plControl.Init();priceLockFlag.Init()}}})();$(document).ready(function(){jetstarFares.init();priceLockHandler.Init(priceLockControlV2,jetstarFares)});